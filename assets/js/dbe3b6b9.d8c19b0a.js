"use strict";(self.webpackChunkdocs=self.webpackChunkdocs||[]).push([[5438],{7187:(e,n,s)=>{s.r(n),s.d(n,{assets:()=>r,contentTitle:()=>i,default:()=>d,frontMatter:()=>c,metadata:()=>t,toc:()=>l});const t=JSON.parse('{"id":"advanced/best-practices","title":"Best Practice","description":"Since this is not an officially sanctioned solution it is temperamental to say the least. Here are some best practices:","source":"@site/docs/advanced/best-practices.md","sourceDirName":"advanced","slug":"/advanced/best-practices","permalink":"/docs/advanced/best-practices","draft":false,"unlisted":false,"editUrl":"https://github.com/facebook/docusaurus/tree/main/packages/create-docusaurus/templates/shared/docs/advanced/best-practices.md","tags":[],"version":"current","frontMatter":{},"sidebar":"tutorialSidebar","previous":{"title":"Multiple Sessions","permalink":"/docs/configuration/multiple-sessions"},"next":{"title":"Chatwoot integrations","permalink":"/docs/Integrations/chatwoot"}}');var a=s(4848),o=s(8453);const c={},i="Best Practice",r={},l=[];function u(e){const n={a:"a",code:"code",h1:"h1",header:"header",li:"li",ol:"ol",p:"p",pre:"pre",...(0,o.R)(),...e.components};return(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(n.header,{children:(0,a.jsx)(n.h1,{id:"best-practice",children:"Best Practice"})}),"\n",(0,a.jsx)(n.p,{children:"Since this is not an officially sanctioned solution it is temperamental to say the least. Here are some best practices:"}),"\n",(0,a.jsxs)(n.ol,{children:["\n",(0,a.jsx)(n.li,{children:"Keep the session alive"}),"\n",(0,a.jsx)(n.li,{children:"Offload most work off of your @open-wa/wa-automate setup (i.e forward all events to a pubsub or something)"}),"\n",(0,a.jsx)(n.li,{children:"Keep the phone nearby just in case you need to reauthenticate"}),"\n",(0,a.jsx)(n.li,{children:"Use a chrome instance instead of the default chromium instance"}),"\n",(0,a.jsx)(n.li,{children:"Use headless: false for easy & quick visual debugging"}),"\n",(0,a.jsx)(n.li,{children:"Implement the unread messages functionality on creation of a session so you don't miss any messages upon any downtime."}),"\n",(0,a.jsxs)(n.li,{children:["Implement a ",(0,a.jsx)(n.a,{href:"https://github.com/sindresorhus/p-queue",children:"promise-queue"})]}),"\n",(0,a.jsx)(n.li,{children:"Use a unique and valid custom user-agent"}),"\n",(0,a.jsxs)(n.li,{children:[(0,a.jsx)(n.code,{children:"await"})," all @open-wa/wa-automate methods just in case"]}),"\n",(0,a.jsx)(n.li,{children:"Do not run your s@open-wa/wa-automate instance on a Windows machine."}),"\n",(0,a.jsxs)(n.li,{children:["Always ",(0,a.jsx)(n.a,{href:"https://open-wa.github.io/wa-automate-nodejs/classes/client.html#kill",children:"kill the session safely"})," upon error or SIGINT."]}),"\n",(0,a.jsx)(n.li,{children:"Regularly restart your process to manage memory consumption"}),"\n",(0,a.jsxs)(n.li,{children:["If memory leaks continue to be an issue then use ",(0,a.jsx)(n.code,{children:"cacheEnabled:false"})," in the config to disable the cache on the page."]}),"\n"]}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-javascript",children:"import { create, Client} from '@open-wa/wa-automate';\nconst { default: PQueue } = require(\"p-queue\");\n\nconst queue = new PQueue({\n  concurrency: 4,\n  autoStart:false\n   });\n\nconst proc = async message => {\n  //do something with the message here\n    console.log(message)\n    return true;\n}\n\nconst processMessage = message => queue.add(()=>proc(message));\n\nasync function start(client: Client) {\n  const unreadMessages = await client.getAllUnreadMessages();\n  unreadMessages.forEach(processMessage)\n  ...\n  await client.onMessage(processMessage);\n  queue.start();\n}\n\ncreate().then(client => start(client));\n\n//create takes 1 argument and that is the config object :\n// https://docs.openwa.dev/interfaces/api_model_config.ConfigObject.html\n\ncreate({\n  // For Mac:\n  executablePath: '/Applications/Google Chrome.app/Contents/MacOS/Google Chrome',\n  // For Windows:\n  // executablePath: 'C:\\\\Program Files (x86)\\\\Google\\\\Chrome\\\\Application\\\\chrome.exe',\n  headless: false,\n  autoRefresh:true,\n  cacheEnabled:false,\n  customUserAgent: 'some custom user agent'\n})\n.then(client => start(client));\n"})})]})}function d(e={}){const{wrapper:n}={...(0,o.R)(),...e.components};return n?(0,a.jsx)(n,{...e,children:(0,a.jsx)(u,{...e})}):u(e)}},8453:(e,n,s)=>{s.d(n,{R:()=>c,x:()=>i});var t=s(6540);const a={},o=t.createContext(a);function c(e){const n=t.useContext(o);return t.useMemo((function(){return"function"==typeof e?e(n):{...n,...e}}),[n,e])}function i(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(a):e.components||a:c(e.components),t.createElement(o.Provider,{value:n},e.children)}}}]);