"use strict";(self.webpackChunkdocs=self.webpackChunkdocs||[]).push([[589],{589:(t,e,s)=>{s.d(e,{default:()=>br});var n={},i=Uint8Array,r=Uint16Array,o=Int32Array,a=new i([0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0,0,0,0]),c=new i([0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13,0,0]),h=new i([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]),u=function(t,e){for(var s=new r(31),n=0;n<31;++n)s[n]=e+=1<<t[n-1];var i=new o(s[30]);for(n=1;n<30;++n)for(var a=s[n];a<s[n+1];++a)i[a]=a-s[n]<<5|n;return{b:s,r:i}},l=u(a,2),d=l.b,p=l.r;d[28]=258,p[258]=28;for(var f=u(c,0).r,g=new r(32768),m=0;m<32768;++m){var b=(43690&m)>>1|(21845&m)<<1;b=(61680&(b=(52428&b)>>2|(13107&b)<<2))>>4|(3855&b)<<4,g[m]=((65280&b)>>8|(255&b)<<8)>>1}var y=function(t,e,s){for(var n=t.length,i=0,o=new r(e);i<n;++i)t[i]&&++o[t[i]-1];var a,c=new r(e);for(i=1;i<e;++i)c[i]=c[i-1]+o[i-1]<<1;if(s){a=new r(1<<e);var h=15-e;for(i=0;i<n;++i)if(t[i])for(var u=i<<4|t[i],l=e-t[i],d=c[t[i]-1]++<<l,p=d|(1<<l)-1;d<=p;++d)a[g[d]>>h]=u}else for(a=new r(n),i=0;i<n;++i)t[i]&&(a[i]=g[c[t[i]-1]++]>>15-t[i]);return a},v=new i(288);for(m=0;m<144;++m)v[m]=8;for(m=144;m<256;++m)v[m]=9;for(m=256;m<280;++m)v[m]=7;for(m=280;m<288;++m)v[m]=8;var S=new i(32);for(m=0;m<32;++m)S[m]=5;var w=y(v,9,0),k=y(S,5,0),T=function(t){return(t+7)/8|0},I=function(t,e,s){return(null==e||e<0)&&(e=0),(null==s||s>t.length)&&(s=t.length),new i(t.subarray(e,s))},E=["unexpected EOF","invalid block type","invalid length/literal","invalid distance","stream finished","no stream handler",,"no callback","invalid UTF-8 data","extra field too long","date not in range 1980-2099","filename too long","stream finishing","invalid zip data"],x=function(t,e,s){var n=new Error(e||E[t]);if(n.code=t,Error.captureStackTrace&&Error.captureStackTrace(n,x),!s)throw n;return n},C=function(t,e,s){s<<=7&e;var n=e/8|0;t[n]|=s,t[n+1]|=s>>8},_=function(t,e,s){s<<=7&e;var n=e/8|0;t[n]|=s,t[n+1]|=s>>8,t[n+2]|=s>>16},N=function(t,e){for(var s=[],n=0;n<t.length;++n)t[n]&&s.push({s:n,f:t[n]});var o=s.length,a=s.slice();if(!o)return{t:F,l:0};if(1==o){var c=new i(s[0].s+1);return c[s[0].s]=1,{t:c,l:1}}s.sort((function(t,e){return t.f-e.f})),s.push({s:-1,f:25001});var h=s[0],u=s[1],l=0,d=1,p=2;for(s[0]={s:-1,f:h.f+u.f,l:h,r:u};d!=o-1;)h=s[s[l].f<s[p].f?l++:p++],u=s[l!=d&&s[l].f<s[p].f?l++:p++],s[d++]={s:-1,f:h.f+u.f,l:h,r:u};var f=a[0].s;for(n=1;n<o;++n)a[n].s>f&&(f=a[n].s);var g=new r(f+1),m=O(s[d-1],g,0);if(m>e){n=0;var b=0,y=m-e,v=1<<y;for(a.sort((function(t,e){return g[e.s]-g[t.s]||t.f-e.f}));n<o;++n){var S=a[n].s;if(!(g[S]>e))break;b+=v-(1<<m-g[S]),g[S]=e}for(b>>=y;b>0;){var w=a[n].s;g[w]<e?b-=1<<e-g[w]++-1:++n}for(;n>=0&&b;--n){var k=a[n].s;g[k]==e&&(--g[k],++b)}m=e}return{t:new i(g),l:m}},O=function(t,e,s){return-1==t.s?Math.max(O(t.l,e,s+1),O(t.r,e,s+1)):e[t.s]=s},M=function(t){for(var e=t.length;e&&!t[--e];);for(var s=new r(++e),n=0,i=t[0],o=1,a=function(t){s[n++]=t},c=1;c<=e;++c)if(t[c]==i&&c!=e)++o;else{if(!i&&o>2){for(;o>138;o-=138)a(32754);o>2&&(a(o>10?o-11<<5|28690:o-3<<5|12305),o=0)}else if(o>3){for(a(i),--o;o>6;o-=6)a(8304);o>2&&(a(o-3<<5|8208),o=0)}for(;o--;)a(i);o=1,i=t[c]}return{c:s.subarray(0,n),n:e}},R=function(t,e){for(var s=0,n=0;n<e.length;++n)s+=t[n]*e[n];return s},D=function(t,e,s){var n=s.length,i=T(e+2);t[i]=255&n,t[i+1]=n>>8,t[i+2]=255^t[i],t[i+3]=255^t[i+1];for(var r=0;r<n;++r)t[i+r+4]=s[r];return 8*(i+4+n)},A=function(t,e,s,n,i,o,u,l,d,p,f){C(e,f++,s),++i[256];for(var g=N(i,15),m=g.t,b=g.l,T=N(o,15),I=T.t,E=T.l,x=M(m),O=x.c,A=x.n,L=M(I),F=L.c,j=L.n,H=new r(19),B=0;B<O.length;++B)++H[31&O[B]];for(B=0;B<F.length;++B)++H[31&F[B]];for(var P=N(H,7),U=P.t,z=P.l,q=19;q>4&&!U[h[q-1]];--q);var W,$,V,X,K=p+5<<3,J=R(i,v)+R(o,S)+u,G=R(i,m)+R(o,I)+u+14+3*q+R(H,U)+2*H[16]+3*H[17]+7*H[18];if(d>=0&&K<=J&&K<=G)return D(e,f,t.subarray(d,d+p));if(C(e,f,1+(G<J)),f+=2,G<J){W=y(m,b,0),$=m,V=y(I,E,0),X=I;var Q=y(U,z,0);C(e,f,A-257),C(e,f+5,j-1),C(e,f+10,q-4),f+=14;for(B=0;B<q;++B)C(e,f+3*B,U[h[B]]);f+=3*q;for(var Y=[O,F],Z=0;Z<2;++Z){var tt=Y[Z];for(B=0;B<tt.length;++B){var et=31&tt[B];C(e,f,Q[et]),f+=U[et],et>15&&(C(e,f,tt[B]>>5&127),f+=tt[B]>>12)}}}else W=w,$=v,V=k,X=S;for(B=0;B<l;++B){var st=n[B];if(st>255){_(e,f,W[(et=st>>18&31)+257]),f+=$[et+257],et>7&&(C(e,f,st>>23&31),f+=a[et]);var nt=31&st;_(e,f,V[nt]),f+=X[nt],nt>3&&(_(e,f,st>>5&8191),f+=c[nt])}else _(e,f,W[st]),f+=$[st]}return _(e,f,W[256]),f+$[256]},L=new o([65540,131080,131088,131104,262176,1048704,1048832,2114560,2117632]),F=new i(0),j=function(t,e,s,n,h,u){var l=u.z||t.length,d=new i(n+l+5*(1+Math.ceil(l/7e3))+h),g=d.subarray(n,d.length-h),m=u.l,b=7&(u.r||0);if(e){b&&(g[0]=u.r>>3);for(var y=L[e-1],v=y>>13,S=8191&y,w=(1<<s)-1,k=u.p||new r(32768),E=u.h||new r(w+1),x=Math.ceil(s/3),C=2*x,_=function(e){return(t[e]^t[e+1]<<x^t[e+2]<<C)&w},N=new o(25e3),O=new r(288),M=new r(32),R=0,F=0,j=u.i||0,H=0,B=u.w||0,P=0;j+2<l;++j){var U=_(j),z=32767&j,q=E[U];if(k[z]=q,E[U]=z,B<=j){var W=l-j;if((R>7e3||H>24576)&&(W>423||!m)){b=A(t,g,0,N,O,M,F,H,P,j-P,b),H=R=F=0,P=j;for(var $=0;$<286;++$)O[$]=0;for($=0;$<30;++$)M[$]=0}var V=2,X=0,K=S,J=z-q&32767;if(W>2&&U==_(j-J))for(var G=Math.min(v,W)-1,Q=Math.min(32767,j),Y=Math.min(258,W);J<=Q&&--K&&z!=q;){if(t[j+V]==t[j+V-J]){for(var Z=0;Z<Y&&t[j+Z]==t[j+Z-J];++Z);if(Z>V){if(V=Z,X=J,Z>G)break;var tt=Math.min(J,Z-2),et=0;for($=0;$<tt;++$){var st=j-J+$&32767,nt=st-k[st]&32767;nt>et&&(et=nt,q=st)}}}J+=(z=q)-(q=k[z])&32767}if(X){N[H++]=268435456|p[V]<<18|f[X];var it=31&p[V],rt=31&f[X];F+=a[it]+c[rt],++O[257+it],++M[rt],B=j+V,++R}else N[H++]=t[j],++O[t[j]]}}for(j=Math.max(j,B);j<l;++j)N[H++]=t[j],++O[t[j]];b=A(t,g,m,N,O,M,F,H,P,j-P,b),m||(u.r=7&b|g[b/8|0]<<3,b-=7,u.h=E,u.p=k,u.i=j,u.w=B)}else{for(j=u.w||0;j<l+m;j+=65535){var ot=j+65535;ot>=l&&(g[b/8|0]=m,ot=l),b=D(g,b+1,t.subarray(j,ot))}u.i=l}return I(d,0,n+T(b)+h)},H=function(){for(var t=new Int32Array(256),e=0;e<256;++e){for(var s=e,n=9;--n;)s=(1&s&&-306674912)^s>>>1;t[e]=s}return t}(),B=function(){var t=-1;return{p:function(e){for(var s=t,n=0;n<e.length;++n)s=H[255&s^e[n]]^s>>>8;t=s},d:function(){return~t}}},P=function(t,e,s,n,r){if(!r&&(r={l:1},e.dictionary)){var o=e.dictionary.subarray(-32768),a=new i(o.length+t.length);a.set(o),a.set(t,o.length),t=a,r.w=o.length}return j(t,null==e.level?6:e.level,null==e.mem?r.l?Math.ceil(1.5*Math.max(8,Math.min(13,Math.log(t.length)))):20:12+e.mem,s,n,r)},U=function(t,e,s){for(var n=t(),i=t.toString(),r=i.slice(i.indexOf("[")+1,i.lastIndexOf("]")).replace(/\s+/g,"").split(","),o=0;o<n.length;++o){var a=n[o],c=r[o];if("function"==typeof a){e+=";"+c+"=";var h=a.toString();if(a.prototype)if(-1!=h.indexOf("[native code]")){var u=h.indexOf(" ",8)+1;e+=h.slice(u,h.indexOf("(",u))}else for(var l in e+=h,a.prototype)e+=";"+c+".prototype."+l+"="+a.prototype[l].toString();else e+=h}else s[c]=a}return e},z=[],q=function(t,e,s,i){if(!z[s]){for(var r="",o={},a=t.length-1,c=0;c<a;++c)r=U(t[c],r,o);z[s]={c:U(t[a],r,o),e:o}}var h=function(t,e){var s={};for(var n in t)s[n]=t[n];for(var n in e)s[n]=e[n];return s}({},z[s].e);return function(t,e,s,i,r){var o=new Worker(n[e]||(n[e]=URL.createObjectURL(new Blob([t+';addEventListener("error",function(e){e=e.error;postMessage({$e$:[e.message,e.code,e.stack]})})'],{type:"text/javascript"}))));return o.onmessage=function(t){var e=t.data,s=e.$e$;if(s){var n=new Error(s[0]);n.code=s[1],n.stack=s[2],r(n,null)}else r(null,e)},o.postMessage(s,i),o}(z[s].c+";onmessage=function(e){for(var k in e.data)self[k]=e.data[k];onmessage="+e.toString()+"}",s,h,function(t){var e=[];for(var s in t)t[s].buffer&&e.push((t[s]=new t[s].constructor(t[s])).buffer);return e}(h),i)},W=function(){return[i,r,o,a,c,h,p,f,w,v,k,S,g,L,F,y,C,_,N,O,M,R,D,A,T,I,j,P,G,V]},$=function(){return[K,J,X,B,H]},V=function(t){return postMessage(t,[t.buffer])},X=function(t,e,s){for(;s;++e)t[e]=s,s>>>=8},K=function(t,e){var s=e.filename;if(t[0]=31,t[1]=139,t[2]=8,t[8]=e.level<2?4:9==e.level?2:0,t[9]=3,0!=e.mtime&&X(t,4,Math.floor(new Date(e.mtime||Date.now())/1e3)),s){t[3]=8;for(var n=0;n<=s.length;++n)t[n+10]=s.charCodeAt(n)}},J=function(t){return 10+(t.filename?t.filename.length+1:0)};function G(t,e){return P(t,e||{},0,0)}function Q(t,e,s){return s||(s=e,e={}),"function"!=typeof s&&x(7),function(t,e,s,n,i,r){var o=q(s,n,i,(function(t,e){o.terminate(),r(t,e)}));return o.postMessage([t,e],e.consume?[t.buffer]:[]),function(){o.terminate()}}(t,e,[W,$,function(){return[Y]}],(function(t){return V(Y(t.data[0],t.data[1]))}),2,s)}function Y(t,e){e||(e={});var s=B(),n=t.length;s.p(t);var i=P(t,e,J(e),8),r=i.length;return K(i,e),X(i,r-8,s.d()),X(i,r-4,n),i}var Z="undefined"!=typeof TextDecoder&&new TextDecoder;try{Z.decode(F,{stream:!0}),1}catch(ii){}class tt{constructor(t){this.getPageNo=t,this.idx=1,this.backDict={},this.getKey=t=>{let e=!1;return this.backDict[t]||(e=!0,this.backDict[t]=`${this.getPageNo()??0}_${this.idx}`,this.idx+=1),[this.backDict[t],e]}}}class et{constructor(t){this.sendSetAttribute=(t,e,s)=>{if(this.isDictDisabled){const n=[12,t,e,s];return this.app.send(n)}{const n=[52,t,this.applyDict(e),this.applyDict(s)];return this.app.send(n)}},this.app=t.app,this.isDictDisabled=t.isDictDisabled,this.dict=new tt(this.app.session.getPageNumber)}applyDict(t){const[e,s]=this.dict.getKey(t);return s&&this.app.send([43,e,t]),e}clear(){this.dict=new tt(this.app.session.getPageNumber)}}class st{constructor(t,e){this.app=t,this.startParams=e,this.conditions=[],this.hasStarted=!1,this.createConditionFromFilter=t=>{if(t.value.length){const e=it(t);if(e.type)return e}},this.durationInt=null}setConditions(t){this.conditions=t}async fetchConditions(t,e){try{const s=await fetch(`${this.app.options.ingestPoint}/v1/web/conditions/${t}`,{method:"GET",headers:{Authorization:`Bearer ${e}`}}),{conditions:n}=await s.json(),i=[];n.forEach((t=>{t.filters.forEach((e=>{let s;"fetch"===e.type?(s={type:"network_request",subConditions:[],name:t.name},e.filters.forEach((t=>{const e=this.createConditionFromFilter(t);e&&s.subConditions.push(e)}))):s=this.createConditionFromFilter(e),s&&("session_duration"===s.type&&this.processDuration(s.value[0],t.name),i.push({...s,name:t.name}))}))})),this.conditions=i}catch(ii){this.app.debug.error("Critical: cannot fetch start conditions")}}trigger(t){if(!this.hasStarted)try{this.hasStarted=!0,this.app.start(this.startParams,void 0,t)}catch(ii){this.app.debug.error(ii)}}processMessage(t){if(!this.hasStarted)switch(t[0]){case 78:this.jsExceptionEvent(t);break;case 27:this.customEvent(t);break;case 68:this.clickEvent(t);break;case 122:this.pageLocationEvent(t);break;case 83:this.networkRequest(t)}}processFlags(t){const e=this.conditions.filter((t=>"feature_flag"===t.type));e.length&&e.forEach((e=>{const s=nt[e.operator];s&&t.find((t=>s(t.key,e.value)))&&this.trigger(e.name)}))}processDuration(t,e){this.durationInt=setInterval((()=>{performance.now()>t&&this.trigger(e)}),1e3),this.app.attachStopCallback((()=>{this.durationInt&&clearInterval(this.durationInt)}))}networkRequest(t){const e=this.conditions.filter((t=>"network_request"===t.type));e.length&&e.forEach((e=>{const s=e.subConditions.filter((t=>"isAny"!==t.operator));if(s.length){s.every((e=>{let s;switch(e.key){case"url":s=t[3];break;case"status":s=t[6];break;case"method":s=t[2];break;case"duration":s=t[8]}const n=nt[e.operator];if(n&&n(s,e.value))return!0}))&&this.trigger(e.name)}else 0===s.length&&e.subConditions.length&&this.trigger(e.name)}))}customEvent(t){const e=this.conditions.filter((t=>"custom_event"===t.type));e.length&&e.forEach((e=>{const s=nt[e.operator];s&&(s(t[1],e.value)||s(t[2],e.value))&&this.trigger(e.name)}))}clickEvent(t){const e=this.conditions.filter((t=>"click"===t.type));e.length&&e.forEach((e=>{const s=nt[e.operator];s&&(s(t[3],e.value)||s(t[4],e.value))&&this.trigger(e.name)}))}pageLocationEvent(t){const e=this.conditions.filter((t=>"visited_url"===t.type));e&&e.forEach((e=>{const s=nt[e.operator];s&&s(t[1],e.value)&&this.trigger(e.name)}))}jsExceptionEvent(t){const e=[t[1],t[2],t[3]],s=this.conditions.filter((t=>"exception"===t.type));s&&s.forEach((t=>{const s=nt[t.operator];s&&e.some((e=>s(e,t.value)))&&this.trigger(t.name)}))}}const nt={is:(t,e)=>e.some((e=>t.includes(e))),isAny:()=>!0,isNot:(t,e)=>!e.some((e=>t.includes(e))),contains:(t,e)=>e.some((e=>t.includes(e))),notContains:(t,e)=>!e.some((e=>t.includes(e))),startsWith:(t,e)=>e.some((e=>t.startsWith(e))),endsWith:(t,e)=>e.some((e=>t.endsWith(e))),greaterThan:(t,e)=>t>e,greaterOrEqual:(t,e)=>t>=e,lessOrEqual:(t,e)=>t<=e,lessThan:(t,e)=>t<e},it=t=>{const e={on:"is",notOn:"isNot",">":"greaterThan","<":"lessThan","=":"is","<=":"lessOrEqual",">=":"greaterOrEqual"},s=t=>{if(Object.keys(e).includes(t))return e[t]};let n={type:"",operator:"",value:t.value,key:""};switch(t.type){case"click":n={type:"click",operator:s(t.operator),value:t.value,key:""};break;case"location":n={type:"visited_url",operator:t.operator,value:t.value,key:""};break;case"custom":n={type:"custom_event",operator:t.operator,value:t.value,key:""};break;case"metadata":n={type:"featureFlag"===t.source?"feature_flag":t.type,operator:t.operator,value:t.value,key:""};break;case"error":n={type:"exception",operator:t.operator,value:t.value,key:""};break;case"duration":n={type:"session_duration",value:t.value[0],key:""};break;case"fetchUrl":n={type:"network_request",key:"url",operator:t.operator,value:t.value};break;case"fetchStatusCode":n={type:"network_request",key:"status",operator:s(t.operator),value:t.value};break;case"fetchMethod":n={type:"network_request",key:"method",operator:s(t.operator),value:t.value};break;case"fetchDuration":n={type:"network_request",key:"duration",operator:s(t.operator),value:t.value}}return n};class rt{constructor(t){this.app=t,this.flags=[],this.storageKey="__openreplay_flags";const e=this.app.sessionStorage.getItem(this.storageKey);if(e){const t=e.split(";").filter(Boolean);this.flags=t.map((t=>JSON.parse(t)))}}getFeatureFlag(t){return this.flags.find((e=>e.key===t))}isFlagEnabled(t){return-1!==this.flags.findIndex((e=>e.key===t))}onFlagsLoad(t){this.onFlagsCb=t}async reloadFlags(t){const e=this.app.sessionStorage.getItem(this.storageKey),s={};if(e){e.split(";").filter(Boolean).forEach((t=>{const e=JSON.parse(t);s[e.key]={key:e.key,value:e.value}}))}const n=this.app.session.getInfo(),i=this.app.session.userInfo,r={projectID:n.projectID,userID:n.userID,metadata:n.metadata,referrer:document.referrer,os:i.userOS,device:i.userDevice,country:i.userCountry,state:i.userState,city:i.userCity,browser:i.userBrowser,persistFlags:s},o=t??this.app.session.getSessionToken(),a=await fetch(this.app.options.ingestPoint+"/v1/web/feature-flags",{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${o}`},body:JSON.stringify(r)});if(200===a.status){const t=await a.json();return this.handleFlags(t.flags)}}handleFlags(t){const e=[];t.forEach((t=>{t.is_persist&&e.push(t)}));let s="";return this.diffPersist(e).forEach((t=>{s+=`${JSON.stringify(t)};`})),this.app.sessionStorage.setItem(this.storageKey,s),this.flags=t,this.onFlagsCb?.(t)}clearPersistFlags(){this.app.sessionStorage.removeItem(this.storageKey)}diffPersist(t){const e=this.app.sessionStorage.getItem(this.storageKey);if(!e)return t;const s=e.split(";").filter(Boolean).map((t=>JSON.parse(t)));return t.filter((t=>-1===s.findIndex((e=>e.key===t.key))))}}const ot={htmlmasked:"hidden",masked:"obscured"},at=!("undefined"==typeof window),ct=at&&navigator.userAgent.match(/firefox|fxios/i);let ht=at?Date.now()-performance.now():0;function ut(){ht=Date.now()-performance.now()}function lt(){return ht}const dt=at&&performance.now?()=>Math.round(performance.now()+ht):()=>Date.now(),pt="repeat"in String.prototype?t=>"*".repeat(t.length):t=>t.replace(/./g,"*");function ft(t){return t.trim().replace(/\s+/g," ")}function gt(t){return t.startsWith("https://")||t.startsWith("http://")}const mt="https://docs.openreplay.com",bt={};function yt(t,e,s="/"){bt[t]||(console.warn(`OpenReplay: ${t} is deprecated. ${e?`Please, use ${e} instead.`:""} Visit ${mt}${s} for more information.`),bt[t]=!0)}function vt(t){let e=t.getAttribute("data-openreplay-label");return null!==e||(e=t.getAttribute("data-asayer-label"),null!==e&&yt('"data-asayer-label" attribute','"data-openreplay-label" attribute',"/")),e}function St(t,e){const s=`data-openreplay-${e}`;return!!t.hasAttribute(s)&&(ot[e]&&yt(`"${s}" attribute`,`"${ot[e]}" attribute`,"/installation/sanitize-data"),!0)}function wt(t){try{return t instanceof HTMLIFrameElement?t.contentDocument:t instanceof Window?t.document:t instanceof Document?t.defaultView:"nodeType"in t?t.nodeType:"addEventListener"in t&&t.addEventListener,!0}catch(ii){if(ii instanceof DOMException&&"SecurityError"===ii.name)return!1}return!0}function kt(t){return t.toString(16).padStart(2,"0")}function Tt(){try{return window.self&&window.top&&window.self!==window.top}catch(ii){return!0}}function It(t){return window.Zone&&"__symbol__"in window.Zone?window.Zone.__symbol__(t):t}function Et(t,e){if(e)return new MutationObserver(t);{const e=It("MutationObserver");return new window[e](t)}}function xt(t,e,s,n,i){if(!wt(t))return;let r="addEventListener";i||(r=It("addEventListener"));try{t[r]?t[r](e,s,n):t.addEventListener(e,s,n)}catch(ii){const n=ii.message;console.error(`Openreplay: ${n}; if this error is caused by an IframeObserver, ignore it`,e,t)}}function Ct(t,e,s,n,i){if(!wt(t))return;let r="removeEventListener";i||(r=It("removeEventListener"));try{t[r]?t[r](e,s,n):t.removeEventListener(e,s,n)}catch(ii){const n=ii.message;console.error(`Openreplay: ${n}; if this error is caused by an IframeObserver, ignore it`,e,t)}}const _t=new class{constructor(){this.taskQueue=[],this.isRunning=!1}addTask(t){this.taskQueue.push(t),this.runTasks()}runTasks(){if(this.isRunning||0===this.taskQueue.length)return;this.isRunning=!0;const t=()=>{if(0===this.taskQueue.length)return void(this.isRunning=!1);const e=this.taskQueue.shift();Promise.resolve(e()).then((()=>{requestAnimationFrame((()=>t()))}))};t()}};function Nt(t,e){const s={...t};for(const n in e)if(e.hasOwnProperty(n)){const i=e[n],r=t[n];"object"!=typeof i||Array.isArray(i)||null===i?s[n]=i:s[n]=Nt(r||{},i)}return s}function Ot(t){return[0,t]}function Mt(t,e){return[5,t,e]}function Rt(t,e){return[6,t,e]}function Dt(t,e,s,n,i){return[8,t,e,s,n,i]}function At(t,e,s){return[9,t,e,s]}function Lt(t,e,s){return[10,t,e,s]}function Ft(t){return[11,t]}function jt(t,e){return[13,t,e]}function Ht(t,e){return[14,t,e]}function Bt(t,e,s){return[16,t,e,s]}function Pt(t,e,s){return[18,t,e,s]}function Ut(t,e){return[19,t,e]}function zt(t,e){return[20,t,e]}function qt(t,e){return[22,t,e]}function Wt(t,e,s,n,i,r,o,a,c){return[23,t,e,s,n,i,r,o,a,c]}function $t(t,e,s){return[24,t,e,s]}function Vt(t,e){return[27,t,e]}function Xt(t){return[28,t]}function Kt(t){return[29,t]}function Jt(t,e){return[30,t,e]}function Gt(t,e,s,n){return[49,t,e,s,n]}function Qt(t,e){return[54,t,e]}function Yt(t){return[55,t]}function Zt(t,e,s,n){return[57,t,e,s,n]}function te(t){return[58,t]}function ee(t,e,s,n){return[60,t,e,s,n]}function se(t,e,s){return[61,t,e,s]}function ne(t,e){return[63,t,e]}function ie(t,e){return[64,t,e]}function re(t,e,s,n,i,r){return[68,t,e,s,n,i,r]}function oe(t,e){return[70,t,e]}function ae(t,e,s){return[71,t,e,s]}function ce(t,e,s,n){return[73,t,e,s,n]}function he(t,e){return[75,t,e]}function ue(t,e){return[76,t,e]}function le(t,e){return[77,t,e]}function de(t,e,s,n){return[78,t,e,s,n]}function pe(t,e,s,n,i,r,o,a,c){return[83,t,e,s,n,i,r,o,a,c]}function fe(t,e,s,n,i,r){return[84,t,e,s,n,i,r]}function ge(t,e,s,n,i,r){return[112,t,e,s,n,i,r]}function me(t,e,s){return[113,t,e,s]}function be(t){return[114,t]}function ye(t){return[115,t]}function ve(t,e,s,n,i,r,o,a,c,h){return[116,t,e,s,n,i,r,o,a,c,h]}function Se(t){return[117,t]}function we(t){return[118,t]}function ke(t,e){return[119,t,e]}function Te(t){return[120,t]}function Ie(t,e,s,n){return[122,t,e,s,n]}function Ee(t,e){return[124,t,e]}const xe=at&&"performance"in window&&"memory"in performance?performance:{memory:{}},Ce=at?1024*(navigator.deviceMemory||0):0,_e=xe.memory.jsHeapSizeLimit||0;const Ne="__or__watched_tags__";class Oe{constructor(t){this.intervals={},this.tags=[],this.sessionStorage=t.sessionStorage,this.errLog=t.errLog,this.onTag=t.onTag;const e=JSON.parse(t.sessionStorage.getItem(Ne)??"[]");this.setTags(e),this.observer=new IntersectionObserver((t=>{t.forEach((t=>{if(t.isIntersecting&&t.target){const e=t.target.__or_watcher_tagname;e&&this.onTagRendered(e),this.observer.unobserve(t.target)}}))}))}async fetchTags(t,e){return fetch(`${t}/v1/web/tags`,{method:"GET",headers:{Authorization:`Bearer ${e}`}}).then((t=>t.json())).then((({tags:t})=>{if(t&&t.length){this.setTags(t);const e=JSON.stringify(t);this.sessionStorage.setItem(Ne,e||"")}})).catch((t=>this.errLog(t)))}setTags(t){this.tags=t,this.intervals={},t.forEach((t=>{this.intervals[t.id]=setInterval((()=>{const e=document.querySelectorAll(t.selector);if(e.length>0){const s=e[0];s.__or_watcher_tagname=t.id,this.observer.observe(s)}}),500)}))}onTagRendered(t){this.intervals[t]&&clearInterval(this.intervals[t]),this.onTag(t)}clear(){this.tags.forEach((t=>{clearInterval(this.intervals[t.id])})),this.tags=[],this.intervals={},this.observer.disconnect()}}const Me={position:"fixed",top:0,left:0,width:"100vw",height:"100vh",background:"rgba(0, 0, 0, 0.40)",display:"flex",alignItems:"center",justifyContent:"center",zIndex:999999,fontFamily:'-apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Helvetica Neue", Arial, sans-serif, "Apple Color Emoji", "Segoe UI Emoji", "Segoe UI Symbol"'},Re={display:"flex",flexDirection:"column",gap:"2rem",alignItems:"center",padding:"1.5rem",borderRadius:"2px",border:"1px solid #D9D9D9",background:"#FFF",width:"22rem"},De={display:"flex","flex-direction":"column",gap:"unset","align-items":"center",padding:"unset",fontFamily:'-apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Helvetica Neue", Arial, sans-serif, "Apple Color Emoji", "Segoe UI Emoji", "Segoe UI Symbol"',"border-radius":"2px",border:"1px solid #D9D9D9",background:"rgba(255, 255, 255, 0.75)",width:"22rem"},Ae={fontFamily:"Verdana, sans-serif",fontSize:"1.25rem",fontStyle:"normal",fontWeight:"500",lineHeight:"1.75rem",color:"rgba(0, 0, 0, 0.85)"},Le={borderTop:"1px solid rgba(0, 0, 0, 0.06)",borderBottom:"1px solid rgba(0, 0, 0, 0.06)",padding:"1.25rem 0rem",color:"rgba(0, 0, 0, 0.85)",fontFamily:"Verdana, sans-serif",fontSize:"13px",fontStyle:"normal",fontWeight:"400",lineHeight:"auto",whiteSpace:"pre-wrap"},Fe={display:"flex",padding:"0.4rem 0.9375rem",justifyContent:"center",alignItems:"center",gap:"0.625rem",borderRadius:"0.25rem",border:"1px solid #394EFF",background:"#394EFF",boxShadow:"0px 2px 0px 0px rgba(0, 0, 0, 0.04)",color:"#FFF",textAlign:"center",fontFamily:"Verdana, sans-serif",fontSize:"1rem",fontStyle:"normal",fontWeight:"500",lineHeight:"1.5rem",cursor:"pointer"},je={fontFamily:"Verdana, sans-serif",fontSize:"13px",fontWeight:"500",lineHeight:"auto",display:"flex",justifyContent:"space-between",width:"100%",cursor:"pointer"},He={display:"flex",flexDirection:"column",alignItems:"flex-start",gap:"0.625rem",fontSize:"13px",lineHeight:"auto"},Be={padding:"0.5rem",gap:"0.5rem",fontFamily:"Verdana, sans-serif",fontSize:"16px",fontStyle:"normal",fontWeight:"500",lineHeight:"auto",color:"white",display:"flex",alignItems:"center",width:"100%",borderRadius:"2px",background:"rgba(0, 0, 0, 0.75)",boxSizing:"border-box"},Pe={boxSizing:"border-box",display:"block",width:"100%",borderBottom:"1px solid #D9D9D9",background:"#FFF",padding:"0.65rem",alignSelf:"stretch",color:"#000",fontFamily:"Verdana, sans-serif",fontStyle:"normal",fontWeight:"400"},Ue={...Pe,display:"flex",flexDirection:"column",alignItems:"center",gap:"0.625rem"},ze={fontSize:"1.25rem",fontWeight:"500",cursor:"pointer",color:"#394EFF"},qe={display:"flex",padding:"0.4rem 0.9375rem",justifyContent:"center",alignItems:"center",gap:"0.625rem",borderRadius:"0.25rem",border:"1px solid #394EFF",background:"#394EFF",boxShadow:"0px 2px 0px 0px rgba(0, 0, 0, 0.04)",color:"#FFF",textAlign:"center",fontFamily:"Verdana, sans-serif",fontSize:"1rem",fontStyle:"normal",fontWeight:"500",lineHeight:"1.5rem",width:"100%",boxSizing:"border-box",cursor:"pointer"},We={marginTop:"1rem",marginBottom:"1rem",cursor:"pointer",display:"block",fontWeight:"500",fontSize:"13px!important",lineHeight:"auto"},$e={display:"flex",justifyContent:"space-between",alignItems:"center",gap:"1rem",padding:"0.5rem",width:"100%",boxSizing:"border-box"},Ve={display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center",borderRadius:"6.25em",outline:"1px solid #394EFF",fontSize:"13px",height:"24px",width:"24px"},Xe={display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center",borderRadius:"6.25em",outline:"1px solid #D2DFFF",boxShadow:"0px 2px 0px 0px rgba(0, 0, 0, 0.04)",background:"#D2DFFF",fontSize:"13px",height:"24px",width:"24px"},Ke={borderRadius:"0.375rem",border:"1px solid rgba(0, 0, 0, 0.06)",background:"#F5F7FF",boxShadow:"0px 2px 0px 0px rgba(0, 0, 0, 0.04)",display:"flex",flexDirection:"column",padding:"0.625rem 0.9375rem",gap:"0.5rem",alignSelf:"stretch"},Je={fontWeight:"bold"},Ge={fontSize:"13px",lineHeight:"auto"},Qe={marginRight:"0.5rem",cursor:"pointer",color:"#394EFF",textAlign:"center",fontFamily:"Verdana, sans-serif",fontSize:"13px",fontStyle:"normal",fontWeight:"500",lineHeight:"auto"},Ye={...Qe,display:"flex",padding:"0.25rem 0.9375rem",justifyContent:"center",alignItems:"center",gap:"0.5rem",borderRadius:"0.25rem",border:"1px solid #394EFF"},Ze={display:"flex",justifyContent:"space-between",alignItems:"center",width:"100%",boxSizing:"border-box"},ts={border:"4px solid rgba(255, 255, 255, 0.4)",width:"16px",height:"16px",borderRadius:"50%",borderLeftColor:"#fff",animation:"spin 0.5s linear infinite"},es={width:1280,height:720};class ss{constructor(t){this.app=t,this.mediaRecorder=null,this.recordedChunks=[],this.stream=null,this.recStartTs=null}async startRecording(t,e,s,n){this.recStartTs=this.app.timestamp();const i=e;try{this.stream=await navigator.mediaDevices.getUserMedia({video:!!n&&{...i,frameRate:{ideal:t}},audio:s}),this.mediaRecorder=new MediaRecorder(this.stream,{mimeType:"video/webm;codecs=vp9"}),this.recordedChunks=[],this.mediaRecorder.ondataavailable=t=>{t.data.size>0&&this.recordedChunks.push(t.data)},this.mediaRecorder.start()}catch(r){console.error(r)}}async stopRecording(){return new Promise((t=>{this.mediaRecorder&&(this.mediaRecorder.onstop=()=>{const e=new Blob(this.recordedChunks,{type:"video/webm"});t(e)},this.mediaRecorder.stop())}))}async sendToAPI(){const t=await this.stopRecording();return fetch(`${this.app.options.ingestPoint}/v1/web/uxt/upload-url`,{headers:{Authorization:`Bearer ${this.app.session.getSessionToken()}`}}).then((t=>{if(t.ok)return t.json();throw new Error("Failed to get upload url")})).then((({url:e})=>fetch(e,{method:"PUT",headers:{"Content-Type":"video/webm"},body:t}))).catch(console.error).finally((()=>{this.discard()}))}async saveToFile(t="recorded-video.webm"){const e=await this.stopRecording(),s=URL.createObjectURL(e),n=document.createElement("a");n.style.display="none",n.href=s,n.download=t,document.body.appendChild(n),n.click(),window.URL.revokeObjectURL(s),document.body.removeChild(n)}discard(){this.mediaRecorder?.stop(),this.stream?.getTracks().forEach((t=>t.stop()))}}function ns(){!function(){const t=document.createElement("style");t.type="text/css",t.innerText="@keyframes spin {\n        0% { transform: rotate(0deg); }\n        100% { transform: rotate(360deg); }\n    }",document.head.appendChild(t)}();const t=document.createElement("div");return t.classList.add("spinner"),Object.assign(t.style,ts),t}function is(t,e,s,n,i){const r=document.createElement(t);return r.className=e,Object.assign(r.style,s),n&&(r.textContent=n),i&&(r.id=i),r}const rs="or_uxt_test_start",os="or_uxt_task_index",as="or_uxt_session_id";class cs{constructor(t,e,s,n,i,r,o,a,c){this.ingestPoint=t,this.getTimestamp=e,this.token=s,this.testId=n,this.storageKey=i,this.setStorageKey=r,this.removeStorageKey=o,this.getStorageKey=a,this.getSessionId=c,this.durations={testStart:0,tasks:[]},this.getDurations=()=>this.durations,this.setDurations=t=>{this.durations.testStart=t.testStart,this.durations.tasks=t.tasks},this.signalTask=(t,e,s)=>{if(!t)return console.error("User Testing: No Task ID Given");const n=this.durations.tasks.find((e=>e.taskId===t)),i=this.getTimestamp(),r=n?i-n.started:0;return fetch(`${this.ingestPoint}/v1/web/uxt/signals/task`,{method:"POST",headers:{Authorization:`Bearer ${this.token}`},body:JSON.stringify({testId:this.testId,taskId:t,status:e,duration:r,timestamp:i,taskAnswer:s})})},this.signalTest=t=>{const e=this.getTimestamp();if("begin"===t&&this.testId){const t=this.getSessionId();this.setStorageKey(as,t),this.setStorageKey(this.storageKey,this.testId.toString()),this.setStorageKey(rs,e.toString())}else this.removeStorageKey(this.storageKey),this.removeStorageKey(os),this.removeStorageKey(rs);const s=e-(this.durations.testStart||e);return fetch(`${this.ingestPoint}/v1/web/uxt/signals/test`,{method:"POST",headers:{Authorization:`Bearer ${this.token}`},body:JSON.stringify({testId:this.testId,status:t,duration:s,timestamp:e})})};const h=this.getStorageKey(rs);h&&(this.durations.testStart=parseInt(h,10))}}class hs{constructor(t,e){this.app=t,this.storageKey=e,this.bg=is("div","bg",Me,void 0,"__or_ut_bg"),this.container=is("div","container",Re,void 0,"__or_ut_ct"),this.widgetGuidelinesVisible=!0,this.widgetTasksVisible=!1,this.widgetVisible=!0,this.isActive=!1,this.descriptionSection=null,this.taskSection=null,this.endSection=null,this.stopButton=null,this.stopButtonContainer=null,this.test=null,this.testId=null,this.signalManager=null,this.getTest=(t,e,s)=>{this.testId=t;const n=this.app.options.ingestPoint;return fetch(`${n}/v1/web/uxt/test/${t}`,{headers:{Authorization:`Bearer ${e}`}}).then((t=>t.json())).then((({test:n})=>{this.isActive=!0,this.test=n,this.signalManager=new cs(this.app.options.ingestPoint,(()=>this.app.timestamp()),e,t,this.storageKey,((t,e)=>this.app.localStorage.setItem(t,e)),(t=>this.app.localStorage.removeItem(t)),(t=>this.app.localStorage.getItem(t)),(()=>this.app.getSessionID())),this.createGreeting(n.title,n.reqMic,n.reqCamera),s&&((n.reqMic||n.reqCamera)&&this.userRecorder.startRecording(30,es,n.reqMic,n.reqCamera),this.showWidget(n.description,n.tasks,!0),this.showTaskSection())})).then((()=>t)).catch((t=>{console.log("OR: Error fetching test",t)}))},this.hideTaskSection=()=>!1,this.showTaskSection=()=>!0,this.collapseWidget=()=>!1,this.removeGreeting=()=>!1,this.toggleDescriptionVisibility=()=>{},this.currentTaskIndex=0,this.userRecorder=new ss(t);this.app.getSessionID()!==this.app.localStorage.getItem(as)&&(this.app.localStorage.removeItem(this.storageKey),this.app.localStorage.removeItem(as),this.app.localStorage.removeItem("or_uxt_test_id"),this.app.localStorage.removeItem(os),this.app.localStorage.removeItem(rs));const s=this.app.localStorage.getItem(os);s&&(this.currentTaskIndex=parseInt(s,10))}getTestId(){return this.testId}createGreeting(t,e,s){const n=is("div","title",Ae,t),i=is("div","description",Le,"Welcome, you're here to help us improve, not to be judged. Your insights matter!\n\n\ud83d\udcf9 We're recording this browser tab to learn from your experience.\n\ud83c\udfa4 Please enable mic and camera if asked, to give us a complete picture."),r=is("div","button",Fe,"Read guidelines to begin");this.removeGreeting=()=>((e||s)&&this.userRecorder.startRecording(30,es,e,s),this.container.removeChild(r),this.container.removeChild(i),this.container.removeChild(n),!1),r.onclick=()=>{this.removeGreeting();const t=this.signalManager?.getDurations();t&&this.signalManager&&(t.testStart=this.app.timestamp(),this.signalManager.setDurations(t)),this.signalManager?.signalTest("begin"),this.container.style.fontFamily='-apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Helvetica Neue", Arial, sans-serif, "Apple Color Emoji", "Segoe UI Emoji", "Segoe UI Symbol"',Object.assign(this.container.style,De),this.showWidget(this.test?.guidelines||"",this.test?.tasks||[])},this.container.append(n,i,r),this.bg.appendChild(this.container),document.body.appendChild(this.bg)}showWidget(t,e,s){this.container.innerHTML="",Object.assign(this.bg.style,{position:"fixed",zIndex:99999999999999,right:"8px",left:"unset",width:"fit-content",top:"8px",height:"fit-content",background:"unset",display:"unset",alignItems:"unset",justifyContent:"unset"});const n=this.createTitleSection();this.container.style.fontFamily='-apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Helvetica Neue", Arial, sans-serif, "Apple Color Emoji", "Segoe UI Emoji", "Segoe UI Symbol"',Object.assign(this.container.style,De);const i=this.createDescriptionSection(t),r=this.createTasksSection(e),o=is("div","stop_bn_or",We,"Abort Session"),a=is("div","stop_ct_or",{fontSize:"13px!important"});a.style.fontSize="13px",a.append(o),this.container.append(n,i,r,a),this.taskSection=r,this.descriptionSection=i,this.stopButton=o,this.stopButtonContainer=a,o.onclick=()=>{this.userRecorder.discard(),this.signalManager?.signalTest("skipped"),document.body.removeChild(this.bg),window.close()},s?this.toggleDescriptionVisibility():this.hideTaskSection()}createTitleSection(){const t=is("div","title",Be),e=function(){const t=document.createElement("div");t.className="grid";for(let e=0;e<16;e++){const e=document.createElement("div");Object.assign(e.style,{width:"2px",height:"2px",borderRadius:"10px",background:"white"}),e.className="cell",t.appendChild(e)}return Object.assign(t.style,{display:"grid",gridTemplateColumns:"repeat(4, 1fr)",gridTemplateRows:"repeat(4, 1fr)",gap:"2px",cursor:"grab"}),t}(),s=is("div","title_text",{maxWidth:"19rem",overflow:"hidden",textOverflow:"ellipsis",width:"100%",fontSize:16,lineHeight:"auto",cursor:"pointer"},this.test?.title),n=function(){const t=document.createElement("div");Object.assign(t.style,{width:"0",height:"0",borderLeft:"7px solid transparent",borderRight:"7px solid transparent",borderBottom:"7px solid white"});const e=document.createElement("div");return e.appendChild(t),Object.assign(e.style,{display:"flex",alignItems:"center",justifyContent:"center",width:"16px",height:"16px",cursor:"pointer",marginLeft:"auto",transform:"rotate(180deg)"}),e}();t.append(e,s,n);const i=t=>(this.widgetVisible=t,this.container.style.fontFamily='-apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Helvetica Neue", Arial, sans-serif, "Apple Color Emoji", "Segoe UI Emoji", "Segoe UI Symbol"',Object.assign(this.container.style,this.widgetVisible?De:{border:"none",background:"none",padding:0}),this.taskSection&&Object.assign(this.taskSection.style,this.widgetVisible?Pe:{display:"none"}),this.descriptionSection&&Object.assign(this.descriptionSection.style,this.widgetVisible?Pe:{display:"none"}),this.endSection&&Object.assign(this.endSection.style,this.widgetVisible?Pe:{display:"none"}),this.stopButton&&Object.assign(this.stopButton.style,this.widgetVisible?We:{display:"none"}),t),r=()=>{Object.assign(n.style,{transform:this.widgetVisible?"rotate(0deg)":"rotate(180deg)"}),i(!this.widgetVisible)};var o,a;return s.onclick=r,n.onclick=r,o=this.bg,(a=e).onmousedown=function(t){const e=o.getBoundingClientRect(),s=t.clientX-e.left,n=t.clientY-e.top;function i(t,i){let r=t-s,a=i-n;r<=5&&(r=5),a<=5&&(a=5),r>=window.innerWidth-e.width&&(r=window.innerWidth-e.width),a>=window.innerHeight-e.height&&(a=window.innerHeight-e.height),o.style.left=`${r}px`,o.style.top=`${a}px`}function r(t){i(t.pageX,t.pageY)}o.style.position="fixed",o.style.zIndex=99999999999999,i(t.pageX,t.pageY),document.addEventListener("mousemove",r);const a=()=>{document.removeEventListener("mousemove",r),document.removeEventListener("mouseup",a)};document.addEventListener("mouseup",a)},a.ondragstart=function(){return!1},this.collapseWidget=()=>i(!1),t}createDescriptionSection(t){const e=is("div","description_section_or",Pe),s=is("div","description_s_title_or",je),n=is("div","title",{fontSize:13,fontWeight:500,lineHeight:"auto"},"Introduction & Guidelines"),i=is("div","icon",ze,"-"),r=is("div","content",He),o=is("div","text_description",{maxHeight:"250px",overflowY:"auto",whiteSpace:"pre-wrap",fontSize:13,color:"#454545",lineHeight:"auto"});o.innerHTML=t;const a=is("div","button_begin_or",qe,"Begin Test");s.append(n,i),r.append(o,a),e.append(s,r);const c=()=>{this.widgetGuidelinesVisible=!this.widgetGuidelinesVisible,i.textContent=this.widgetGuidelinesVisible?"-":"+",Object.assign(r.style,this.widgetGuidelinesVisible?He:{display:"none"})};return s.onclick=c,this.toggleDescriptionVisibility=()=>{this.widgetGuidelinesVisible=!1,i.textContent=this.widgetGuidelinesVisible?"-":"+",Object.assign(r.style,this.widgetGuidelinesVisible?He:{display:"none"}),r.removeChild(a)},a.onclick=()=>{if(c(),this.test){const t=this.signalManager?.getDurations(),e=t?t.tasks.findIndex((t=>this.test&&t.taskId===this.test.tasks[0].task_id)):null;t&&-1===e&&(t.tasks.push({taskId:this.test.tasks[0].task_id,started:this.app.timestamp()}),this.signalManager?.setDurations(t)),this.signalManager?.signalTask(this.test.tasks[0].task_id,"begin")}this.showTaskSection(),r.removeChild(a)},e}createTasksSection(t){this.container.style.fontFamily='-apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Helvetica Neue", Arial, sans-serif, "Apple Color Emoji", "Segoe UI Emoji", "Segoe UI Symbol"',Object.assign(this.container.style,De);const e=is("div","task_section_or",Pe),s=is("div","description_t_title_or",je),n=is("div","title",{fontSize:"13px",fontWeight:"500",lineHeight:"auto"},"Tasks"),i=is("div","icon",ze,"-"),r=is("div","content",He),o=is("div","pagination",$e),a=is("div","taskCard",Ke),c=is("div","taskText",Je),h=is("div","taskDescription",Ge),u=is("div","taskButtons",Ze),l=is("div","taskText",Je);l.textContent="Your answer";const d=is("textarea","taskDescription",{resize:"vertical"}),p=is("div","inputArea",Ke);p.append(l,d);const f=is("div","closePanelButton",Qe,"Collapse Panel"),g=is("div","nextButton",Ye,"Done, Next");s.append(n,i),a.append(c,h),u.append(f,g),r.append(o,a,p,u),e.append(s,r);const m=()=>{const e=t[this.currentTaskIndex];c.textContent=e.title,h.textContent=e.description,e.allow_typing?p.style.display="flex":p.style.display="none"};t.forEach(((t,e)=>{const s=is("span",`or_task_${e}`,{outline:"1px solid #efefef",fontSize:"13px",height:"24px",width:"24px",display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center",borderRadius:"6.25em"},(e+1).toString());s.id=`or_task_${e}`,o.append(s)}));this.hideTaskSection=()=>(i.textContent="+",Object.assign(r.style,{display:"none"}),this.widgetTasksVisible=!1,!1),this.showTaskSection=()=>(i.textContent="-",Object.assign(r.style,He),this.widgetTasksVisible=!0,!0);const b=()=>{const t=document.getElementById(`or_task_${this.currentTaskIndex}`);t&&Object.assign(t.style,Ve);for(let e=0;e<this.currentTaskIndex;e++){const t=document.getElementById(`or_task_${e}`);t&&Object.assign(t.style,Xe)}};return s.onclick=()=>{this.widgetTasksVisible=!this.widgetTasksVisible,i.textContent=this.widgetTasksVisible?"-":"+",Object.assign(r.style,this.widgetTasksVisible?He:{display:"none"})},f.onclick=this.collapseWidget,g.onclick=()=>{const e=t[this.currentTaskIndex].allow_typing?d.value:void 0;if(d.value="",this.signalManager?.signalTask(t[this.currentTaskIndex].task_id,"done",e),this.currentTaskIndex<t.length-1){this.currentTaskIndex++,m();const e=this.signalManager?.getDurations();e&&-1===e.tasks.findIndex((e=>e.taskId===t[this.currentTaskIndex].task_id))&&(e.tasks.push({taskId:t[this.currentTaskIndex].task_id,started:this.app.timestamp()}),this.signalManager?.setDurations(e)),this.signalManager?.signalTask(t[this.currentTaskIndex].task_id,"begin"),b()}else this.showEndSection();this.app.localStorage.setItem("or_uxt_task_index",this.currentTaskIndex.toString())},setTimeout((()=>{const t=document.getElementById("or_task_0");t&&Object.assign(t.style,Ve),m(),b()}),1),e}showEndSection(){let t=!0;this.signalManager?.signalTest("done");const e=is("div","end_section_or",Ue),s=is("div","end_title_or",{fontSize:"1.25rem",fontWeight:"500"},"Thank you! \ud83d\udc4d"),n=is("div","end_description_or",{},this.test?.conclusion??"Thank you for participating in our usability test. Your feedback has been captured and will be used to enhance our website. \n\nWe appreciate your time and valuable input."),i=is("div","end_button_or",qe,"Submitting Feedback"),r=ns();i.appendChild(r),this.test?.reqMic||this.test?.reqCamera?this.userRecorder.sendToAPI().then((()=>{i.removeChild(r),i.textContent="End Session",t=!1})).catch((e=>{console.error(e),i.removeChild(r),i.textContent="End Session",t=!1})):(i.removeChild(r),i.textContent="End Session",t=!1),this.taskSection&&this.container.removeChild(this.taskSection),this.descriptionSection&&this.container.removeChild(this.descriptionSection),this.stopButton&&this.stopButtonContainer&&this.container.removeChild(this.stopButtonContainer),i.onclick=()=>{t||(window.close(),document.body.removeChild(this.bg))},e.append(s,n,i),this.endSection=e,this.container.append(e)}}function us(t){return!!t&&null!=t.nodeType}function ls(t){return"http://www.w3.org/2000/svg"===t.namespaceURI}function ds(t){return t.nodeType===Node.ELEMENT_NODE}function ps(t){return t.nodeType===Node.TEXT_NODE}function fs(t){return t.nodeType===Node.DOCUMENT_NODE}function gs(t){return t.nodeType===Node.DOCUMENT_NODE||t.nodeType===Node.DOCUMENT_FRAGMENT_NODE}function ms(t,e){return t.localName===e}class bs{constructor(t,e){this.app=t,this.options=e,this.snapshots={},this.intervals=[],this.restartTracking=()=>{this.clear(),this.app.nodes.scanTree(this.captureCanvas)},this.captureCanvas=t=>{const e=this.app.nodes.getID(t);if(!e||!ms(t,"canvas"))return;if(this.app.sanitizer.isObscured(e)||this.app.sanitizer.isHidden(e)||!ms(t,"canvas")||this.snapshots[e])return;new IntersectionObserver((t=>{t.forEach((t=>{t.isIntersecting&&(t.target?this.snapshots[e]&&this.snapshots[e].createdAt?this.snapshots[e].paused=!1:this.recordCanvas(t.target,e):this.snapshots[e]&&(this.snapshots[e].paused=!0))}))})).observe(t)},this.recordCanvas=(t,e)=>{const s=this.app.timestamp();this.snapshots[e]={images:[],createdAt:s,paused:!1,dummy:document.createElement("canvas")};const n=ke(e.toString(),s);this.app.send(n);const i=t=>{!function(t,e="medium",s,n=!1,i,r){const o=`image/${i}`;if(n){const n=window.devicePixelRatio||1;s.width=t.width/n,s.height=t.height/n;const i=s.getContext("2d");if(!i)return"";i.clearRect(0,0,s.width,s.height),i.drawImage(t,0,0,s.width,s.height),s.toBlob(r,o,ys[e])}else t.toBlob(r,o,ys[e])}(t,this.options.quality,this.snapshots[e].dummy,this.options.fixedScaling,this.fileExt,(t=>{if(t){if(!this.snapshots[e])return this.app.debug.warn("Canvas not present in snapshots after capture:",this.snapshots,e);this.snapshots[e].images.push({id:this.app.timestamp(),data:t}),this.snapshots[e].images.length>9&&(this.sendSnaps(this.snapshots[e].images,e,this.snapshots[e].createdAt),this.snapshots[e].images=[])}}))},r=setInterval((()=>{const s=this.app.nodes.getID(t),n=s?this.app.nodes.getNode(s):void 0;return this.snapshots[e]?n&&ms(n,"canvas")&&n===t?void(this.snapshots[e].paused||(this.options.useAnimationFrame?requestAnimationFrame((()=>{i(n)})):i(n))):(this.app.debug.log("Canvas element not in sync",n,t),void clearInterval(r)):(this.app.debug.log("Canvas is not present in {snapshots}"),void clearInterval(r))}),this.interval);this.intervals.push(r)},this.fileExt=e.fileExt??"webp",this.interval=1e3/e.fps}startTracking(){setTimeout((()=>{this.app.nodes.scanTree(this.captureCanvas),this.app.nodes.attachNodeCallback(this.captureCanvas)}),250)}sendSnaps(t,e,s){if(0===Object.keys(this.snapshots).length)return;const n=new FormData;t.forEach((t=>{const i=t.data;i&&(n.append("snapshot",i,`${s}_${e}_${t.id}.${this.fileExt}`),this.options.isDebug&&function(t,e){const s=URL.createObjectURL(t),n=document.createElement("a");n.href=s,n.download=e,n.style.display="none",document.body.appendChild(n),n.click(),document.body.removeChild(n)}(i,`${s}_${e}_${t.id}.${this.fileExt}`))}));const i=()=>{this.app.debug.log("Restarting tracker; token expired"),this.app.stop(!1),setTimeout((()=>{this.app.start({},!0)}),250)};fetch(this.app.options.ingestPoint+"/v1/web/images",{method:"POST",headers:{Authorization:`Bearer ${this.app.session.getSessionToken()??""}`},body:n}).then((t=>401!==t.status||i())).catch((t=>{this.app.debug.error("error saving canvas",t)}))}clear(){this.intervals.forEach((t=>clearInterval(t))),this.snapshots={}}}const ys={low:.35,medium:.55,high:.8};const vs=5,Ss=4,ws=3,ks=2,Ts=0;class Is{constructor(t=Ts){this.shouldLog=t=>this.level>=t,this.info=(...t)=>{this.shouldLog(vs)&&console.info(...t)},this.log=(...t)=>{this.shouldLog(Ss)&&console.log(...t)},this.warn=(...t)=>{this.shouldLog(ws)&&console.warn(...t)},this.error=(...t)=>{this.shouldLog(ks)&&console.error(...t)},this.level=t}}const Es={interval:3e4,batchSize:2500,enabled:!0};class xs{constructor(t,e,s){this.nodes=t,this.unregisterNode=e,this.start=()=>{this.options.enabled&&(this.stop(),this.interval=setInterval((()=>{!function(t,e,s){const n=t.entries();!function t(){const i=[];let r=n.next();for(;!r.done&&i.length<e;)i.push(r.value),r=n.next();i.length>0&&(i.forEach((([t,e])=>{e&&s(e)})),setTimeout(t,50))}()}(this.nodes,this.options.batchSize,(t=>{const e=function(t){try{if(!t.isConnected)return[!1,"not connected"];const e=t.nodeType===Node.DOCUMENT_NODE,s=e?t.defaultView:t.ownerDocument?.defaultView,n=e?t:t.ownerDocument;return s?s.closed?[!1,"window closed"]:n?.documentElement.isConnected?[!0,"ok"]:[!1,"documentElement not connected"]:[!1,"no window"]}catch(ii){return[!1,ii]}}(t)[0];e||this.unregisterNode(t)}))}),this.options.interval))},this.stop=()=>{this.interval&&clearInterval(this.interval)},this.options={...Es,...s}}}class Cs{constructor(t){this.nodes=new Map,this.totalNodeAmount=0,this.nodeCallbacks=[],this.elementListeners=new Map,this.nextNodeId=0,this.attachNodeCallback=t=>this.nodeCallbacks.push(t),this.scanTree=t=>{this.nodes.forEach((e=>e?t(e):void 0))},this.attachNodeListener=(t,e,s,n=!0)=>{const i=this.getID(t);if(void 0===i)return;xt(t,e,s,n,this.forceNgOff);let r=this.elementListeners.get(i);void 0===r&&(r=[],this.elementListeners.set(i,r)),r.push([e,s,n])},this.unregisterNode=t=>{const e=t[this.node_id];if(void 0!==e){t[this.node_id]=void 0,delete t[this.node_id],this.nodes.delete(e);const s=this.elementListeners.get(e);void 0!==s&&(this.elementListeners.delete(e),s.forEach((e=>Ct(t,e[0],e[1],e[2],this.forceNgOff)))),this.totalNodeAmount--}return e},this.node_id=t.node_id,this.forceNgOff=t.forceNgOff,this.maintainer=new xs(this.nodes,this.unregisterNode,t.maintainer),this.maintainer.start()}syntheticMode(t){const e=99999999*t;if(e>Number.MAX_SAFE_INTEGER)throw new Error("Placeholder id overflow");this.nextNodeId=e}registerNode(t){let e=t[this.node_id];const s=void 0===e;return s&&(e=this.nextNodeId,this.totalNodeAmount++,this.nextNodeId++,this.nodes.set(e,t),t[this.node_id]=e),[e,s]}cleanTree(){for(const[t,e]of this.nodes)e&&!document.contains(e)&&this.unregisterNode(e)}callNodeCallbacks(t,e){this.nodeCallbacks.forEach((s=>s(t,e)))}getID(t){if(t)return t[this.node_id]}getNode(t){return this.nodes.get(t)}getNodeCount(){return this.totalNodeAmount}clear(){for(const[t,e]of this.nodes)e&&this.unregisterNode(e);this.nextNodeId=0,this.nodes.clear()}}function _s(t){if(function(t){return t.nodeType===Node.COMMENT_NODE}(t))return!0;if(ps(t))return!1;if(!ds(t))return!0;const e=t.tagName.toUpperCase();if("LINK"===e){const e=t.getAttribute("rel"),s=t.getAttribute("as");return!(e?.includes("stylesheet")||"style"===s||"font"===s)}return"SCRIPT"===e||"NOSCRIPT"===e||"META"===e||"TITLE"===e||"BASE"===e}function Ns(t){return!!gs(t)||!_s(t)}var Os;!function(t){t[t.New=0]="New",t[t.Removed=1]="Removed",t[t.Changed=2]="Changed"}(Os||(Os={}));class Ms{constructor(t,e=!1){this.app=t,this.isTopContext=e,this.commited=[],this.recents=new Map,this.indexes=[],this.attributesMap=new Map,this.textSet=new Set,this.observer=Et(this.app.safe((t=>{for(const e of t){const t=e.target,s=e.type;if(!Ns(t))continue;if("childList"===s){for(let t=0;t<e.removedNodes.length;t++)Ns(e.removedNodes[t])&&this.bindNode(e.removedNodes[t]);for(let t=0;t<e.addedNodes.length;t++)this.bindTree(e.addedNodes[t]);continue}const n=this.app.nodes.getID(t);if(void 0!==n)if(this.recents.has(n)||this.recents.set(n,Os.Changed),"attributes"!==s)"characterData"!==s||this.textSet.add(n);else{const t=e.attributeName;if(null===t)continue;let s=this.attributesMap.get(n);void 0===s&&this.attributesMap.set(n,s=new Set),s.add(t)}}this.commitNodes()})),this.app.options.forceNgOff)}clear(){this.commited.length=0,this.recents.clear(),this.indexes.length=1,this.attributesMap.clear(),this.textSet.clear()}handleIframeSrcChange(t){const e=t.contentDocument;if(e){if(void 0!==this.app.nodes.getID(e)){const s=document.createTreeWalker(e,NodeFilter.SHOW_ELEMENT+NodeFilter.SHOW_TEXT,{acceptNode:t=>_s(t)||void 0===this.app.nodes.getID(t)?NodeFilter.FILTER_REJECT:NodeFilter.FILTER_ACCEPT},!1);let n=0;const i=this.app.nodes.getNodeCount();for(;s.nextNode();)t.contentDocument.contains(s.currentNode)||(n+=1,this.app.nodes.unregisterNode(s.currentNode));const r=Math.floor(n/i*100);r>30&&this.app.send(ye(r))}}}sendNodeAttribute(t,e,s,n){if(ls(e))return"xlink:"===s.substring(0,6)&&(s=s.substring(6)),void(null===n?this.app.send(jt(t,s)):"href"===s?(n.length>1e5&&(n=""),this.app.send(ee(t,s,n,this.app.getBaseHref()))):this.app.attributeSender.sendSetAttribute(t,s,n));"src"!==s&&"srcset"!==s&&"integrity"!==s&&"crossorigin"!==s&&"autocomplete"!==s&&"on"!==s.substring(0,2)&&("value"===s&&ms(e,"input")&&"button"!==e.type&&"reset"!==e.type&&"submit"!==e.type||(null!==n?"style"===s||"href"===s&&ms(e,"link")?this.app.send(ee(t,s,n,this.app.getBaseHref())):(("href"===s||n.length>1e5)&&(n=""),this.app.attributeSender.sendSetAttribute(t,s,n)):this.app.send(jt(t,s))))}sendNodeData(t,e,s){ms(e,"style")?this.app.send(se(t,s,this.app.getBaseHref())):(s=this.app.sanitizer.sanitize(t,s),this.app.send(Ht(t,s)))}bindNode(t){const[e,s]=this.app.nodes.registerNode(t);s?this.recents.set(e,Os.New):this.recents.get(e)!==Os.New&&this.recents.set(e,Os.Removed)}bindTree(t){if(!Ns(t))return;this.bindNode(t);const e=document.createTreeWalker(t,NodeFilter.SHOW_ELEMENT+NodeFilter.SHOW_TEXT,{acceptNode:t=>(void 0!==this.app.nodes.getID(t)&&this.app.debug.error("! Node is already bound",t),_s(t)||void 0!==this.app.nodes.getID(t)?NodeFilter.FILTER_REJECT:NodeFilter.FILTER_ACCEPT)},!1);for(;e.nextNode();)this.bindNode(e.currentNode)}unbindTree(t){const e=this.app.nodes.unregisterNode(t);if(void 0!==e&&this.recents.get(e)===Os.Removed){this.app.send(Ft(e));const s=document.createTreeWalker(t,NodeFilter.SHOW_ELEMENT+NodeFilter.SHOW_TEXT,{acceptNode:t=>_s(t)||void 0===this.app.nodes.getID(t)?NodeFilter.FILTER_REJECT:NodeFilter.FILTER_ACCEPT},!1);let n=0;const i=this.app.nodes.getNodeCount();for(;s.nextNode();)n+=1,this.app.nodes.unregisterNode(s.currentNode);const r=Math.floor(n/i*100);r>30&&this.app.send(ye(r))}}_commitNode(t,e){if(gs(e))return!0;const s=e.parentNode;let n;if(!ms(e,"html")||!this.isTopContext){if(null===s)return this.unbindTree(e),!1;if(n=this.app.nodes.getID(s),void 0===n)return this.unbindTree(e),!1;if(!this.commitNode(n))return this.unbindTree(e),!1;if(this.app.sanitizer.handleNode(t,n,e),this.app.sanitizer.isHidden(n))return!1}let i=e.previousSibling;for(;null!==i;){const e=this.app.nodes.getID(i);if(void 0!==e){this.commitNode(e),this.indexes[t]=this.indexes[e]+1;break}i=i.previousSibling}null===i&&(this.indexes[t]=0);const r=this.recents.get(t),o=r===Os.New,a=this.indexes[t];if(void 0===a)throw"commitNode: missing node index";if(o){if(ds(e)){let s=e;if(void 0!==n){if(this.app.sanitizer.isHidden(t)){const t=s.clientWidth,n=s.clientHeight;s=e.cloneNode(),s.style.width=`${t}px`,s.style.height=`${n}px`}this.app.send(Dt(t,n,a,s.tagName,ls(e)))}for(let e=0;e<s.attributes.length;e++){const n=s.attributes[e];this.sendNodeAttribute(t,s,n.nodeName,n.value)}}else ps(e)&&(this.app.send(At(t,n,a)),this.sendNodeData(t,s,e.data));return!0}r===Os.Removed&&void 0!==n&&this.app.send(Lt(t,n,a));const c=this.attributesMap.get(t);if(void 0!==c){if(!ds(e))throw"commitNode: node is not an element";for(const s of c)this.sendNodeAttribute(t,e,s,e.getAttribute(s))}if(this.textSet.has(t)){if(!ps(e))throw"commitNode: node is not a text";this.sendNodeData(t,s,e.data)}return!0}commitNode(t){const e=this.app.nodes.getNode(t);if(!e)return!1;const s=this.commited[t];return void 0!==s?s:this.commited[t]=this._commitNode(t,e)}commitNodes(t=!1){let e;this.recents.forEach(((s,n)=>{this.commitNode(n),s===Os.New&&(e=this.app.nodes.getNode(n))&&this.app.nodes.callNodeCallbacks(e,t)})),this.clear()}observeRoot(t,e,s=t){this.observer.observe(t,{childList:!0,attributes:!0,characterData:!0,subtree:!0,attributeOldValue:!1,characterDataOldValue:!1}),this.bindTree(s),e(this.app.nodes.getID(t)),this.commitNodes(!0)}disconnect(){this.observer.disconnect(),this.clear()}}class Rs extends Ms{observe(t){const e=t.contentDocument,s=this.app.nodes.getID(t);e&&void 0!==s&&this.observeRoot(e,(t=>{void 0!==t?(this.docId=t,this.app.send(oe(s,t))):this.app.debug.log("OpenReplay: Iframe document not bound")}))}syntheticObserve(t,e){this.observeRoot(e,(e=>{void 0!==e?this.app.send(oe(t,e)):this.app.debug.log("OpenReplay: Iframe document not bound")}))}}class Ds extends Ms{observe(t){const e=t.shadowRoot,s=this.app.nodes.getID(t);e&&void 0!==s&&this.observeRoot(e,(t=>{void 0!==t?this.app.send(oe(s,t)):this.app.debug.error("OpenReplay: Shadow Root was not bound")}))}}class As{constructor(){this.states=new WeakMap}calcOffset(t){let e=0,s=0;if(t.parent&&([e,s]=this.calcOffset(t.parent)),!t.offset){const{left:e,top:s}=t.iFrame.getBoundingClientRect();t.offset=[e,s]}const[n,i]=t.offset;return[e+n,s+i]}getDocumentOffset(t){const e=this.states.get(t);return e?this.calcOffset(e):[0,0]}observe(t){const e=t.contentDocument;if(!e)return;const s=t.ownerDocument,n={offset:null,iFrame:t,parent:this.states.get(s)||null,clear:()=>{s.removeEventListener("scroll",i),s.defaultView?.removeEventListener("resize",i)}},i=()=>{n.offset=null};s.addEventListener("scroll",i),s.defaultView?.addEventListener("resize",i),this.states.set(e,n)}clear(){this.states=new WeakMap}}const Ls=at?Element.prototype.attachShadow:()=>new ShadowRoot;class Fs extends Ms{constructor(t){super(t.app,!0),this.iframeOffsets=new As,this.contextCallbacks=[],this.contextsSet=new WeakSet,this.iframeObserversArr=[],this.iframeObservers=new WeakMap,this.docObservers=new WeakMap,this.shadowRootObservers=new WeakMap,this.app=t.app,this.options=Object.assign({captureIFrames:!0},t.options),this.app.nodes.attachNodeCallback((t=>{ms(t,"iframe")&&(this.options.captureIFrames&&!St(t,"obscured")||St(t,"capture"))&&this.handleIframe(t)})),this.app.nodes.attachNodeCallback((t=>{ds(t)&&null!==t.shadowRoot&&this.handleShadowRoot(t.shadowRoot)}))}attachContextCallback(t){this.contextCallbacks.push(t)}getDocumentOffset(t){return this.iframeOffsets.getDocumentOffset(t)}handleIframe(t){const e=this.app.safe((()=>setTimeout((()=>{const e=this.app.nodes.getID(t);if(void 0===e||!function(t){try{return Boolean(t.contentDocument)}catch(ii){return!1}}(t))return;const s=t.contentWindow,n=t.contentDocument;if(!n)return void this.app.debug.warn("no doc for iframe found",t);if(n&&this.docObservers.has(n))return void this.app.debug.info("doc already observed for",e);const i=new Rs(this.app);this.iframeObservers.set(t,i),this.docObservers.set(n,i),this.iframeObserversArr.push(i),i.observe(t),this.iframeOffsets.observe(t),s&&s===s.window&&!this.contextsSet.has(s)&&(this.contextsSet.add(s),this.contextCallbacks.forEach((t=>t(s))))}),250)));t.addEventListener("load",e),e()}handleShadowRoot(t){const e=new Ds(this.app);this.shadowRootObservers.set(t,e),e.observe(t.host)}observe(){const t=this;Element.prototype.attachShadow=function(){const e=Ls.apply(this,arguments);return t.handleShadowRoot(e),e},this.app.nodes.clear(),this.observeRoot(window.document,(()=>{this.app.send([7]),this.app.nodes.callNodeCallbacks(document,!0)}),window.document.documentElement)}crossdomainObserve(t,e){const s=this;Element.prototype.attachShadow=function(){const t=Ls.apply(this,arguments);return s.handleShadowRoot(t),t},this.app.nodes.clear(),this.app.nodes.syntheticMode(e);const n=new Rs(this.app);this.iframeObservers.set(window.document,n),n.syntheticObserve(t,window.document)}disconnect(){this.iframeOffsets.clear(),Element.prototype.attachShadow=Ls,this.iframeObserversArr.forEach((t=>t.disconnect())),this.iframeObserversArr=[],this.iframeObservers=new WeakMap,this.shadowRootObservers=new WeakMap,this.docObservers=new WeakMap,super.disconnect()}}var js;!function(t){t[t.Plain=0]="Plain",t[t.Obscured=1]="Obscured",t[t.Hidden=2]="Hidden"}(js||(js={}));class Hs{constructor(t){this.obscured=new Set,this.hidden=new Set,this.app=t.app,this.options=Object.assign({obscureTextEmails:!0,obscureTextNumbers:!1},t.options)}handleNode(t,e,s){if((this.obscured.has(e)||ds(s)&&(St(s,"masked")||St(s,"obscured")))&&this.obscured.add(t),(this.hidden.has(e)||ds(s)&&(St(s,"htmlmasked")||St(s,"hidden")))&&this.hidden.add(t),void 0!==this.options.domSanitizer&&ds(s)){const e=this.options.domSanitizer(s);e===js.Obscured&&this.obscured.add(t),e===js.Hidden&&this.hidden.add(t)}}sanitize(t,e){return this.obscured.has(t)?e.trim().replace(/[^\f\n\r\t\v\u00a0\u1680\u2000-\u200a\u2028\u2029\u202f\u205f\u3000\ufeff]/g,"\u2588"):(this.options.obscureTextNumbers&&(e=e.replace(/\d/g,"0")),this.options.obscureTextEmails&&(e=e.replace(/^\w+([+.-]\w+)*@\w+([.-]\w+)*\.\w{2,3}$/g,(t=>{const[e,s]=t.split("@"),[n,i]=s.split(".");return`${pt(e)}@${pt(n)}.${pt(i)}`}))),e)}isObscured(t){return this.obscured.has(t)}isHidden(t){return this.hidden.has(t)}getInnerTextSecure(t){const e=this.app.nodes.getID(t);return e?this.sanitize(e,t.innerText):""}clear(){this.obscured.clear(),this.hidden.clear()}}class Bs{constructor(t){this.metadata={},this.userID=null,this.callbacks=[],this.timestamp=0,this.getPageNumber=()=>{const t=this.app.sessionStorage.getItem(this.options.session_pageno_key);if(null!=t)return parseInt(t)},this.incPageNo=()=>{let t=this.getPageNumber();return void 0===t?t=0:t++,this.app.sessionStorage.setItem(this.options.session_pageno_key,t.toString()),t},this.app=t.app,this.options=t.options,this.createTabId()}attachUpdateCallback(t){this.callbacks.push(t)}handleUpdate(t){null==t.userID&&delete t.userID,null==t.sessionID&&delete t.sessionID,this.callbacks.forEach((e=>e(t)))}assign(t){void 0!==t.userID&&(this.userID=t.userID),void 0!==t.metadata&&Object.entries(t.metadata).forEach((([t,e])=>this.metadata[t]=e)),void 0!==t.sessionID&&(this.sessionID=t.sessionID),void 0!==t.timestamp&&(this.timestamp=t.timestamp),void 0!==t.projectID&&(this.projectID=t.projectID),this.handleUpdate(t)}setMetadata(t,e){this.metadata[t]=e,this.handleUpdate({metadata:{[t]:e}})}setUserID(t){this.userID=t,this.handleUpdate({userID:t})}setUserInfo(t){this.userInfo=t}getSessionToken(){return this.token||this.app.sessionStorage.getItem(this.options.session_token_key)||void 0}setSessionToken(t){this.token=t,this.app.sessionStorage.setItem(this.options.session_token_key,t)}applySessionHash(t){const e=decodeURI(t).split("&");let s=t,n="100500";2==e.length&&([n,s]=e),n&&s&&(this.app.sessionStorage.setItem(this.options.session_token_key,s),this.app.sessionStorage.setItem(this.options.session_pageno_key,n))}getSessionHash(){const t=this.getPageNumber(),e=this.getSessionToken();if(void 0!==t&&void 0!==e)return encodeURI(String(t)+"&"+e)}getTabId(){return this.tabId||this.createTabId(),this.tabId}regenerateTabId(){const t=function(t){const e=new Uint8Array(t/2),s=window.crypto||window.msCrypto;return s?(s.getRandomValues(e),Array.from(e,kt).join("")):Array.from({length:t},(()=>kt(Math.floor(16*Math.random())))).join("")}(12);this.app.sessionStorage.setItem(this.options.session_tabid_key,t),this.tabId=t}createTabId(){const t=this.app.sessionStorage.getItem(this.options.session_tabid_key);t?this.tabId=t:this.regenerateTabId()}getInfo(){return{sessionID:this.sessionID,metadata:this.metadata,userID:this.userID,timestamp:this.timestamp,projectID:this.projectID}}reset(){this.app.sessionStorage.removeItem(this.options.session_token_key),this.metadata={},this.userID=null,this.sessionID=void 0,this.timestamp=0}}class Ps{constructor(t){this.app=t,this.timer=null,this.callbacks=[]}attach(t,e=0,s=!0,n){n&&(t=t.bind(n)),s&&(t=this.app.safe(t)),this.callbacks.unshift(e?function(t,e){let s=0;return()=>{s++>=e&&(s=0,t())}}(t,e):t)}start(){null===this.timer&&(this.timer=setInterval((()=>this.callbacks.forEach((t=>{t&&t()}))),30))}stop(){null!==this.timer&&(clearInterval(this.timer),this.timer=null)}}const Us="canceled",zs="or_uxt_active",qs="or_buffer_1",Ws=t=>({reason:t,success:!1}),$s=t=>({...t,success:!0});var Vs;!function(t){t[t.NotActive=0]="NotActive",t[t.Starting=1]="Starting",t[t.Active=2]="Active",t[t.ColdStart=3]="ColdStart"}(Vs||(Vs={}));const Xs="https://api.openreplay.com/ingest";function Ks(){const t=-1*(new Date).getTimezoneOffset(),e=t>=0?"+":"-",s=Math.floor(Math.abs(t)/60),n=Math.abs(t)%60;return`UTC${e}${String(s).padStart(2,"0")}:${String(n).padStart(2,"0")}`}const Js=t=>new Promise((e=>setTimeout(e,t))),Gs="never-gonna-give-you-up",Qs="never-gonna-let-you-down",Ys="never-gonna-run-around-and-desert-you",Zs="tracker inside a child iframe",tn="getting node id for child iframe",en="batch of messages from an iframe window",sn="signal that parent is live",nn="stop tracker inside frame",rn="start tracker inside frame",on="hello-how-are-you-im-under-the-water-please-help-me";class an{constructor(t,e,s,n,i){this.signalError=n,this.insideIframe=i,this.messages=[],this.bufferedMessages1=[],this.bufferedMessages2=[],this.startCallbacks=[],this.stopCallbacks=[],this.commitCallbacks=[],this.activityState=Vs.NotActive,this.version="15.0.3",this.socketMode=!1,this.compressionThreshold=24e3,this.bc=null,this.canvasRecorder=null,this.conditionsManager=null,this.canStart=!1,this.rootId=null,this.pageFrames=[],this.frameOderNumber=0,this.features={"feature-flags":!0,"usability-test":!0},this.parentActive=!1,this.checkStatus=()=>this.parentActive,this.parentCrossDomainFrameListener=t=>{const{data:e}=t;if(e&&t.source!==window){if(e.line===rn){if(this.active())return;try{this.allowAppStart(),this.start()}catch(ii){console.error("children frame restart failed:",ii)}}e.line===sn&&(this.parentActive=!0),e.line===tn&&(this.parentActive=!0,this.rootId=e.id,this.session.setSessionToken(e.token),this.frameOderNumber=e.frameOrderNumber,this.debug.log("starting iframe tracking",e),this.allowAppStart()),e.line===nn&&this.active()&&this.stop()}},this.trackedFrames=[],this.crossDomainIframeListener=t=>{if(!this.active()||t.source===window)return;const{data:e}=t;if(e){if(e.line===Zs){t.source?.postMessage({ping:!0,line:sn},"*");const s=async()=>{if(null===t.source)return console.error("Couldnt connect to event.source for child iframe tracking");const s=await this.checkNodeId(t.source);if(s)try{this.trackedFrames.includes(e.context)?this.debug.log("Trying to observe already added iframe; ignore if its a restart"):this.trackedFrames.push(e.context),await this.waitStarted();const n=this.session.getSessionToken(),i=this.trackedFrames.findIndex((t=>t===e.context))+1;0===i&&this.debug.error("Couldnt get order number for iframe",e.context,this.trackedFrames);const r={line:tn,id:s,token:n,frameOrderNumber:i};this.debug.log("Got child frame signal; nodeId",s,t.source,r),t.source?.postMessage(r,"*")}catch(ii){console.error(ii)}else this.debug.log("Couldnt get node id for iframe",t.source)};s()}if(e.line===en){const s=e.messages.map((e=>{if(20===e[0]){let s=e;return this.pageFrames.forEach((n=>{if(n.contentWindow===t.source){const[t,i,r]=e,{left:o,top:a}=n.getBoundingClientRect();s=[t,i+o,r+a]}})),s}if(68===e[0]){let s=e;return this.pageFrames.forEach((n=>{if(n.contentWindow===t.source){const[t,i,r,o,a,c,h]=e,{left:u,top:l,width:d,height:p}=n.getBoundingClientRect(),f=(c/100*d+u)/document.documentElement.scrollWidth,g=(h/100*p+l)/document.documentElement.scrollHeight;s=[t,i,r,o,a,Math.round(1e3*f)/10,Math.round(1e3*g)/10]}})),s}return e}));this.messages.push(...s)}if(e.line===on){if(!this.pollingQueue.order.length)return;const s=this.pollingQueue.order[0];if(s&&0===this.pollingQueue[s].length)return void(this.pollingQueue.order=this.pollingQueue.order.filter((t=>t!==s)));this.pollingQueue[s].includes(e.context)&&(this.pollingQueue[s]=this.pollingQueue[s].filter((t=>t!==e.context)),t.source?.postMessage({line:s},"*"),0===this.pollingQueue[s].length&&this.pollingQueue.order.shift())}}},this.pollingQueue={order:[]},this.addCommand=t=>{this.pollingQueue.order.push(t),this.pollingQueue[t]=[...this.trackedFrames]},this.bootChildrenFrames=async()=>{await this.waitStarted(),this.addCommand(rn)},this.killChildrenFrames=()=>{this.addCommand(nn)},this.signalIframeTracker=()=>{const t=this.session.getTabId();window.parent.postMessage({line:Zs,source:t,context:this.contextId},this.options.crossdomain?.parentDomain??"*");let e=0,s=250,n=0,i=!1;const r=()=>{i||this.checkStatus()?i=!0:(window.parent.postMessage({line:Zs,source:t,context:this.contextId},this.options.crossdomain?.parentDomain??"*"),this.debug.info("Trying to signal to parent, attempt:",e+1),e++)};for(let o=0;o<10;o++){if(this.checkStatus()){i=!0;break}n+=s,setTimeout((()=>{r()}),n),s*=1.5}},this.startTimeout=null,this.coldStartCommitN=0,this.delay=0,this.attachStartCallback=(t,e=!1)=>{e&&(t=this.safe(t)),this.startCallbacks.push(t)},this.attachStopCallback=(t,e=!1)=>{e&&(t=this.safe(t)),this.stopCallbacks.push(t)},this.attachEventListener=(t,e,s,n=!0,i=!0)=>{n&&(s=this.safe(s));this.attachStartCallback((()=>t?xt(t,e,s,i,this.options.forceNgOff):null),n),this.attachStopCallback((()=>t?Ct(t,e,s,i,this.options.forceNgOff):null),n)},this.coldInterval=null,this.orderNumber=0,this.coldStartTs=0,this.singleBuffer=!1,this.onSessionSent=()=>{},this.prevOpts={},this.restartCanvasTracking=()=>{this.canvasRecorder?.restartTracking()},this.flushBuffer=async t=>new Promise((e=>{let s=!1;const n=[t.shift()];for(;!s;){const e=t[0];e&&0!==e[0]?n.push(t.shift()):s=!0}this.postToWorker(n),e(null)})),this.onUxtCb=[],this.contextId=Math.random().toString(36).slice(2),this.projectKey=t,-1!==Object.keys(s).findIndex((t=>["fixedCanvasScaling","disableCanvas"].includes(t)))&&(console.warn('Openreplay: canvas options are moving to separate key "canvas" in next update. Please update your configuration.'),s={...s,canvas:{__save_canvas_locally:s.__save_canvas_locally,fixedCanvasScaling:s.fixedCanvasScaling,disableCanvas:s.disableCanvas}}),this.networkOptions=s.network;const r={revID:"",node_id:"__openreplay_id",session_token_key:"__openreplay_token",session_pageno_key:"__openreplay_pageno",session_reset_key:"__openreplay_reset",session_tabid_key:"__openreplay_tabid",local_uuid_key:"__openreplay_uuid",ingestPoint:Xs,resourceBaseHref:null,__is_snippet:!1,__debug_report_edp:null,__debug__:Ts,__save_canvas_locally:!1,localStorage:null,sessionStorage:null,disableStringDict:!1,forceSingleTab:!1,assistSocketHost:"",fixedCanvasScaling:!1,disableCanvas:!1,captureIFrames:!0,obscureTextEmails:!0,obscureTextNumbers:!1,crossdomain:{parentDomain:"*"},canvas:{disableCanvas:!1,fixedCanvasScaling:!1,__save_canvas_locally:!1,useAnimationFrame:!1},forceNgOff:!1};if(this.options=Nt(r,s),!this.insideIframe&&!this.options.forceSingleTab&&globalThis&&"BroadcastChannel"in globalThis){const t=location.hostname.split(".").slice(-2).join("_");this.bc=new BroadcastChannel(`rick_${t}`)}this.revID=this.options.revID,this.localStorage=this.options.localStorage??window.localStorage,this.sessionStorage=this.options.sessionStorage??window.sessionStorage,this.sanitizer=new Hs({app:this,options:s}),this.nodes=new Cs({node_id:this.options.node_id,forceNgOff:Boolean(s.forceNgOff),maintainer:this.options.nodes?.maintainer}),this.observer=new Fs({app:this,options:s}),this.ticker=new Ps(this),this.ticker.attach((()=>this.commit())),this.debug=new Is(this.options.__debug__),this.session=new Bs({app:this,options:this.options}),this.attributeSender=new et({app:this,isDictDisabled:Boolean(this.options.disableStringDict||this.options.crossdomain?.enabled)}),this.featureFlags=new rt(this),this.tagWatcher=new Oe({sessionStorage:this.sessionStorage,errLog:this.debug.error,onTag:t=>this.send(Te(t))}),this.session.attachUpdateCallback((({userID:t,metadata:e})=>{null!=t&&this.send(Xt(t)),null!=e&&Object.entries(e).forEach((([t,e])=>this.send(Jt(t,e))))})),null!=e&&this.session.applySessionHash(e);const o=this.session.getTabId();this.insideIframe?(window.addEventListener("message",this.parentCrossDomainFrameListener),setInterval((()=>{document.hidden||window.parent.postMessage({line:on,context:this.contextId},s.crossdomain?.parentDomain??"*")}),250)):(this.initWorker(),window.addEventListener("message",this.crossDomainIframeListener)),null!==this.bc&&(this.bc.postMessage({line:Gs,source:o,context:this.contextId}),this.startTimeout=setTimeout((()=>{this.allowAppStart()}),250),this.bc.onmessage=t=>{if(t.data.context!==this.contextId){if(t.data.line===Qs){const e=t.data.token;this.session.setSessionToken(e),this.allowAppStart()}if(t.data.line===Ys){const e=t.data.token;this.session.regenerateTabId(),this.session.setSessionToken(e),this.allowAppStart()}if(t.data.line===Gs){const e=this.session.getSessionToken();e&&this.bc&&this.bc.postMessage({line:t.data.source===o?Ys:Qs,token:e,source:o,context:this.contextId})}}})}allowAppStart(){this.canStart=!0,this.startTimeout&&(clearTimeout(this.startTimeout),this.startTimeout=null)}async checkNodeId(t){let e;if(this.pageFrames.length>0&&(e=this.pageFrames.find((e=>e.contentWindow===t))),!e||!this.pageFrames.length){const s=Array.from(document.querySelectorAll("iframe"));this.pageFrames=s,e=s.find((e=>e.contentWindow===t))}if(!e)return null;let s=0;for(;s<100;){const t=e[this.options.node_id];if(void 0!==t)return s=100,t;s++,await Js(100)}return null}initWorker(){try{this.worker=new Worker(URL.createObjectURL(new Blob(['!function(){"use strict";class t{constructor(t,s,i,e=10,n=250,h,r){this.onUnauthorised=s,this.onFailure=i,this.MAX_ATTEMPTS_COUNT=e,this.ATTEMPT_TIMEOUT=n,this.onCompress=h,this.pageNo=r,this.attemptsCount=0,this.busy=!1,this.queue=[],this.token=null,this.lastBatchNum=0,this.ingestURL=t+"/v1/web/i",this.isCompressing=void 0!==h}getQueueStatus(){return 0===this.queue.length&&!this.busy}authorise(t){this.token=t,this.busy||this.sendNext()}push(t){if(this.busy||!this.token)this.queue.push(t);else if(this.busy=!0,this.isCompressing&&this.onCompress)this.onCompress(t);else{const s=++this.lastBatchNum;this.sendBatch(t,!1,s)}}sendNext(){const t=this.queue.shift();if(t)if(this.busy=!0,this.isCompressing&&this.onCompress)this.onCompress(t);else{const s=++this.lastBatchNum;this.sendBatch(t,!1,s)}else this.busy=!1}retry(t,s,i){this.attemptsCount>=this.MAX_ATTEMPTS_COUNT?this.onFailure(`Failed to send batch after ${this.attemptsCount} attempts.`):(this.attemptsCount++,setTimeout((()=>this.sendBatch(t,s,i)),this.ATTEMPT_TIMEOUT*this.attemptsCount))}sendBatch(t,s,i){var e;const n=null==i?void 0:i.toString().replace(/^([^_]+)_([^_]+).*/,"$1_$2_$3");this.busy=!0;const h={Authorization:`Bearer ${this.token}`};s&&(h["Content-Encoding"]="gzip"),null!==this.token?fetch(`${this.ingestURL}?batch=${null!==(e=this.pageNo)&&void 0!==e?e:"noPageNum"}_${null!=n?n:"noBatchNum"}`,{body:t,method:"POST",headers:h,keepalive:t.length<65536}).then((e=>{if(401===e.status)return this.busy=!1,void this.onUnauthorised();e.status>=400?this.retry(t,s,`${null!=i?i:"noBatchNum"}_network:${e.status}`):(this.attemptsCount=0,this.sendNext())})).catch((e=>{console.warn("OpenReplay:",e),this.retry(t,s,`${null!=i?i:"noBatchNum"}_reject:${e.message}`)})):setTimeout((()=>{this.sendBatch(t,s,`${null!=i?i:"noBatchNum"}_newToken`)}),500)}sendCompressed(t){const s=++this.lastBatchNum;this.sendBatch(t,!0,s)}sendUncompressed(t){const s=++this.lastBatchNum;this.sendBatch(t,!1,s)}clean(){this.sendNext(),setTimeout((()=>{this.token=null,this.queue.length=0}),10)}}const s="function"==typeof TextEncoder?new TextEncoder:{encode(t){const s=t.length,i=new Uint8Array(3*s);let e=-1;for(let n=0,h=0,r=0;r!==s;){if(n=t.charCodeAt(r),r+=1,n>=55296&&n<=56319){if(r===s){i[e+=1]=239,i[e+=1]=191,i[e+=1]=189;break}if(h=t.charCodeAt(r),!(h>=56320&&h<=57343)){i[e+=1]=239,i[e+=1]=191,i[e+=1]=189;continue}if(n=1024*(n-55296)+h-56320+65536,r+=1,n>65535){i[e+=1]=240|n>>>18,i[e+=1]=128|n>>>12&63,i[e+=1]=128|n>>>6&63,i[e+=1]=128|63&n;continue}}n<=127?i[e+=1]=0|n:n<=2047?(i[e+=1]=192|n>>>6,i[e+=1]=128|63&n):(i[e+=1]=224|n>>>12,i[e+=1]=128|n>>>6&63,i[e+=1]=128|63&n)}return i.subarray(0,e+1)}};class i{constructor(t){this.size=t,this.offset=0,this.checkpointOffset=0,this.data=new Uint8Array(t)}getCurrentOffset(){return this.offset}checkpoint(){this.checkpointOffset=this.offset}get isEmpty(){return 0===this.offset}skip(t){return this.offset+=t,this.offset<=this.size}set(t,s){this.data.set(t,s)}boolean(t){return this.data[this.offset++]=+t,this.offset<=this.size}uint(t){for((t<0||t>Number.MAX_SAFE_INTEGER)&&(t=0);t>=128;)this.data[this.offset++]=t%256|128,t=Math.floor(t/128);return this.data[this.offset++]=t,this.offset<=this.size}int(t){return t=Math.round(t),this.uint(t>=0?2*t:-2*t-1)}string(t){const i=s.encode(t),e=i.byteLength;return!(!this.uint(e)||this.offset+e>this.size)&&(this.data.set(i,this.offset),this.offset+=e,!0)}reset(){this.offset=0,this.checkpointOffset=0}flush(){const t=this.data.slice(0,this.checkpointOffset);return this.reset(),t}}class e extends i{encode(t){switch(t[0]){case 0:case 11:case 114:case 115:return this.uint(t[1]);case 4:case 44:case 47:return this.string(t[1])&&this.string(t[2])&&this.uint(t[3]);case 5:case 20:case 38:case 70:case 75:case 76:case 77:case 82:return this.uint(t[1])&&this.uint(t[2]);case 6:return this.int(t[1])&&this.int(t[2]);case 7:return!0;case 8:return this.uint(t[1])&&this.uint(t[2])&&this.uint(t[3])&&this.string(t[4])&&this.boolean(t[5]);case 9:case 10:case 24:case 51:return this.uint(t[1])&&this.uint(t[2])&&this.uint(t[3]);case 12:case 52:case 61:case 71:return this.uint(t[1])&&this.string(t[2])&&this.string(t[3]);case 13:case 14:case 17:case 50:case 54:return this.uint(t[1])&&this.string(t[2]);case 16:return this.uint(t[1])&&this.int(t[2])&&this.int(t[3]);case 18:return this.uint(t[1])&&this.string(t[2])&&this.int(t[3]);case 19:return this.uint(t[1])&&this.boolean(t[2]);case 21:return this.string(t[1])&&this.string(t[2])&&this.string(t[3])&&this.string(t[4])&&this.string(t[5])&&this.uint(t[6])&&this.uint(t[7])&&this.uint(t[8]);case 22:case 27:case 30:case 41:case 45:case 46:case 43:case 63:case 64:case 79:case 124:return this.string(t[1])&&this.string(t[2]);case 23:return this.uint(t[1])&&this.uint(t[2])&&this.uint(t[3])&&this.uint(t[4])&&this.uint(t[5])&&this.uint(t[6])&&this.uint(t[7])&&this.uint(t[8])&&this.uint(t[9]);case 28:case 29:case 42:case 117:case 118:return this.string(t[1]);case 37:return this.uint(t[1])&&this.string(t[2])&&this.uint(t[3]);case 39:return this.string(t[1])&&this.string(t[2])&&this.string(t[3])&&this.string(t[4])&&this.uint(t[5])&&this.uint(t[6])&&this.uint(t[7]);case 40:return this.string(t[1])&&this.uint(t[2])&&this.string(t[3])&&this.string(t[4]);case 48:return this.string(t[1])&&this.string(t[2])&&this.string(t[3])&&this.string(t[4])&&this.int(t[5]);case 49:return this.int(t[1])&&this.int(t[2])&&this.uint(t[3])&&this.uint(t[4]);case 53:return this.uint(t[1])&&this.uint(t[2])&&this.uint(t[3])&&this.uint(t[4])&&this.uint(t[5])&&this.uint(t[6])&&this.string(t[7])&&this.string(t[8]);case 55:return this.boolean(t[1]);case 57:case 60:return this.uint(t[1])&&this.string(t[2])&&this.string(t[3])&&this.string(t[4]);case 58:case 120:return this.int(t[1]);case 59:return this.uint(t[1])&&this.uint(t[2])&&this.uint(t[3])&&this.uint(t[4])&&this.string(t[5])&&this.string(t[6])&&this.string(t[7]);case 67:case 73:return this.uint(t[1])&&this.string(t[2])&&this.uint(t[3])&&this.string(t[4]);case 68:return this.uint(t[1])&&this.uint(t[2])&&this.string(t[3])&&this.string(t[4])&&this.uint(t[5])&&this.uint(t[6]);case 69:return this.uint(t[1])&&this.uint(t[2])&&this.string(t[3])&&this.string(t[4]);case 78:return this.string(t[1])&&this.string(t[2])&&this.string(t[3])&&this.string(t[4]);case 81:return this.uint(t[1])&&this.uint(t[2])&&this.uint(t[3])&&this.int(t[4])&&this.string(t[5]);case 83:return this.string(t[1])&&this.string(t[2])&&this.string(t[3])&&this.string(t[4])&&this.string(t[5])&&this.uint(t[6])&&this.uint(t[7])&&this.uint(t[8])&&this.uint(t[9]);case 84:return this.string(t[1])&&this.string(t[2])&&this.string(t[3])&&this.uint(t[4])&&this.string(t[5])&&this.string(t[6]);case 112:return this.uint(t[1])&&this.string(t[2])&&this.boolean(t[3])&&this.string(t[4])&&this.int(t[5])&&this.int(t[6]);case 113:return this.uint(t[1])&&this.uint(t[2])&&this.string(t[3]);case 116:return this.uint(t[1])&&this.uint(t[2])&&this.uint(t[3])&&this.uint(t[4])&&this.uint(t[5])&&this.uint(t[6])&&this.string(t[7])&&this.string(t[8])&&this.uint(t[9])&&this.boolean(t[10]);case 119:return this.string(t[1])&&this.uint(t[2]);case 121:return this.string(t[1])&&this.string(t[2])&&this.uint(t[3])&&this.uint(t[4]);case 122:return this.string(t[1])&&this.string(t[2])&&this.uint(t[3])&&this.string(t[4]);case 123:return this.string(t[1])&&this.string(t[2])&&this.string(t[3])&&this.string(t[4])&&this.uint(t[5])}}}class n{constructor(t,s,i,n,h,r){this.pageNo=t,this.timestamp=s,this.url=i,this.onBatch=n,this.tabId=h,this.onOfflineEnd=r,this.nextIndex=0,this.beaconSize=2e5,this.encoder=new e(this.beaconSize),this.sizeBuffer=new Uint8Array(3),this.isEmpty=!0,this.beaconSizeLimit=1e6,this.prepare()}writeType(t){return this.encoder.uint(t[0])}writeFields(t){return this.encoder.encode(t)}writeSizeAt(t,s){for(let s=0;s<3;s++)this.sizeBuffer[s]=t>>8*s;this.encoder.set(this.sizeBuffer,s)}prepare(){if(!this.encoder.isEmpty)return;const t=[81,1,this.pageNo,this.nextIndex,this.timestamp,this.url],s=[118,this.tabId];this.writeType(t),this.writeFields(t),this.writeWithSize(s),this.isEmpty=!0}writeWithSize(t){const s=this.encoder;if(!this.writeType(t)||!s.skip(3))return!1;const i=s.getCurrentOffset(),e=this.writeFields(t);if(e){const e=s.getCurrentOffset()-i;if(e>16777215)return console.warn("OpenReplay: max message size overflow."),!1;this.writeSizeAt(e,i-3),s.checkpoint(),this.isEmpty=this.isEmpty&&0===t[0],this.nextIndex++}return e}setBeaconSizeLimit(t){this.beaconSizeLimit=t}writeMessage(t){if("q_end"===t[0])return this.finaliseBatch(),this.onOfflineEnd();0===t[0]&&(this.timestamp=t[1]),122===t[0]&&(this.url=t[1]),this.writeWithSize(t)||(this.finaliseBatch(),this.writeWithSize(t)||(this.encoder=new e(this.beaconSizeLimit),this.prepare(),this.writeWithSize(t)?this.finaliseBatch():console.warn("OpenReplay: beacon size overflow. Skipping large message.",t,this),this.encoder=new e(this.beaconSize),this.prepare()))}finaliseBatch(){if(this.isEmpty)return;const t=this.encoder.flush();this.onBatch(t),this.prepare()}clean(){this.encoder.reset()}}var h;!function(t){t[t.NotActive=0]="NotActive",t[t.Starting=1]="Starting",t[t.Stopping=2]="Stopping",t[t.Active=3]="Active",t[t.Stopped=4]="Stopped"}(h||(h={}));let r=null,u=null,a=h.NotActive;function o(){u&&u.finaliseBatch()}function c(){return new Promise((t=>{a=h.Stopping,null!==p&&(clearInterval(p),p=null),u&&(u.clean(),u=null),r&&(r.clean(),setTimeout((()=>{r=null}),20)),setTimeout((()=>{a=h.NotActive,t(null)}),100)}))}function g(){[h.Stopped,h.Stopping].includes(a)||(postMessage("a_stop"),c().then((()=>{postMessage("a_start")})))}let l,p=null;self.onmessage=({data:s})=>{if(null!=s){if("stop"===s)return o(),void c().then((()=>{a=h.Stopped}));if("forceFlushBatch"!==s){if(!Array.isArray(s)){if("compressed"===s.type){if(!r)return console.debug("OR WebWorker: sender not initialised. Compressed batch."),void g();s.batch&&r.sendCompressed(s.batch)}if("uncompressed"===s.type){if(!r)return console.debug("OR WebWorker: sender not initialised. Uncompressed batch."),void g();s.batch&&r.sendUncompressed(s.batch)}return"start"===s.type?(a=h.Starting,r=new t(s.ingestPoint,(()=>{g()}),(t=>{!function(t){postMessage({type:"failure",reason:t}),c()}(t)}),s.connAttemptCount,s.connAttemptGap,(t=>{postMessage({type:"compress",batch:t},[t.buffer])}),s.pageNo),u=new n(s.pageNo,s.timestamp,s.url,(t=>{r&&r.push(t)}),s.tabId,(()=>postMessage({type:"queue_empty"}))),null===p&&(p=setInterval(o,1e4)),a=h.Active):"auth"===s.type?r?u?(r.authorise(s.token),void(s.beaconSizeLimit&&u.setBeaconSizeLimit(s.beaconSizeLimit))):(console.debug("OR WebWorker: writer not initialised. Received auth."),void g()):(console.debug("OR WebWorker: sender not initialised. Received auth."),void g()):void 0}if(u){const t=u;s.forEach((s=>{55===s[0]&&(s[1]?l=setTimeout((()=>g()),18e5):clearTimeout(l)),t.writeMessage(s)}))}else postMessage("not_init"),g()}else o()}else o()}}();\n'],{type:"text/javascript"}))),this.worker.onerror=t=>{this._debug("webworker_error",t)},this.worker.onmessage=({data:t})=>{this.handleWorkerMsg(t)};const t=()=>{this.worker&&this.worker.postMessage(null)};this.attachEventListener(window,"beforeunload",t,!1),this.attachEventListener(document.body,"mouseleave",t,!1,!1),this.attachEventListener(document,"visibilitychange",t,!1)}catch(ii){this._debug("worker_start",ii)}}handleWorkerMsg(t){if("a_stop"===t)this.stop(!1);else if("a_start"===t)this.waitStatus(Vs.NotActive).then((()=>{this.allowAppStart(),this.start(this.prevOpts,!0).then((t=>{this.debug.info("Worker restart, session too long",t)})).catch((t=>{this.debug.error("Worker restart failed",t)}))}));else if("not_init"===t)this.debug.warn("OR WebWorker: writer not initialised. Restarting tracker");else if("failure"===t.type)this.stop(!1),this.debug.error("worker_failed",t.reason),this._debug("worker_failed",t.reason);else if("compress"===t.type){const e=t.batch;e.byteLength>this.compressionThreshold?Q(t.batch,{mtime:0},((t,s)=>{t?(this.debug.error("Openreplay compression error:",t),this.worker?.postMessage({type:"uncompressed",batch:e})):this.worker?.postMessage({type:"compressed",batch:s})})):this.worker?.postMessage({type:"uncompressed",batch:e})}else"queue_empty"===t.type&&this.onSessionSent()}_debug(t,e){null!==this.options.__debug_report_edp&&fetch(this.options.__debug_report_edp,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({context:t,error:`${e}`})}),this.debug.error("OpenReplay error: ",t,e)}send(t,e=!1){this.activityState!==Vs.NotActive&&(this.activityState===Vs.ColdStart?(this.bufferedMessages1.push(t),this.singleBuffer||this.bufferedMessages2.push(t),this.conditionsManager?.processMessage(t)):this.messages.push(t),this.activityState===Vs.Active&&e&&this.commit())}_nCommit(){if(this.socketMode)return this.messages.unshift(we(this.session.getTabId())),this.messages.unshift(Ot(this.timestamp())),this.commitCallbacks.forEach((t=>t(this.messages))),void(this.messages.length=0);if(this.insideIframe)return window.parent.postMessage({line:en,messages:this.messages},this.options.crossdomain?.parentDomain??"*"),this.commitCallbacks.forEach((t=>t(this.messages))),void(this.messages.length=0);var t;if(void 0!==this.worker&&this.messages.length)try{t=()=>{this.messages.unshift(we(this.session.getTabId())),this.messages.unshift(Ot(this.timestamp())),this.worker?.postMessage(this.messages),this.commitCallbacks.forEach((t=>t(this.messages))),this.messages.length=0},_t.addTask(t)}catch(ii){this._debug("worker_commit",ii),this.stop(!0),setTimeout((()=>{this.start()}),500)}}_cStartCommit(){this.coldStartCommitN+=1,2===this.coldStartCommitN&&(this.bufferedMessages1.push(Ot(this.timestamp())),this.bufferedMessages1.push(we(this.session.getTabId())),this.bufferedMessages2.push(Ot(this.timestamp())),this.bufferedMessages2.push(we(this.session.getTabId())),this.coldStartCommitN=0)}commit(){this.activityState===Vs.ColdStart?this._cStartCommit():this._nCommit()}postToWorker(t){this.worker?.postMessage(t),this.commitCallbacks.forEach((e=>e(t))),t.length=0}timestamp(){return dt()+this.delay}safe(t){const e=this;return function(...s){try{t.apply(this,s)}catch(ii){e._debug("safe_fn_call",ii)}}}attachCommitCallback(t){this.commitCallbacks.push(t)}checkRequiredVersion(t){const e=t.split(/[.-]/),s=this.version.split(/[.-]/);for(let n=0;n<3;n++){if(isNaN(Number(s[n]))||isNaN(Number(e[n])))return!1;if(Number(s[n])>Number(e[n]))return!0;if(Number(s[n])<Number(e[n]))return!1}return!0}getTrackerInfo(){return{userUUID:this.localStorage.getItem(this.options.local_uuid_key),projectKey:this.projectKey,revID:this.revID,trackerVersion:this.version,isSnippet:this.options.__is_snippet}}getSessionInfo(){return{...this.session.getInfo(),...this.getTrackerInfo()}}getSessionToken(){return this.session.getSessionToken()}getSessionID(){return this.session.getInfo().sessionID||void 0}getSessionURL(t){const{projectID:e,sessionID:s,timestamp:n}=this.session.getInfo();if(!e||!s)return void this.debug.error("OpenReplay error: Unable to build session URL");const i=this.options.ingestPoint,r=(/api\.openreplay\.com/.test(i)?"https://app.openreplay.com/ingest":i).replace(/ingest$/,`${e}/session/${s}`);if(t?.withCurrentTime){return`${r}?jumpto=${dt()-n}`}return r}getHost(){return new URL(this.options.ingestPoint).host}getProjectKey(){return this.projectKey}getBaseHref(){return"string"==typeof this.options.resourceBaseHref?this.options.resourceBaseHref:(this.options.resourceBaseHref,document.baseURI?document.baseURI:document.head?.getElementsByTagName("base")[0]?.getAttribute("href")||location.origin+location.pathname)}resolveResourceURL(t){const e=new URL(this.getBaseHref());return e.pathname+="/"+new URL(t).pathname,e.pathname.replace(/\/+/g,"/"),e.toString()}isServiceURL(t){return t.startsWith(this.options.ingestPoint)}active(){return this.activityState===Vs.Active}resetNextPageSession(t){t?this.sessionStorage.setItem(this.options.session_reset_key,"t"):this.sessionStorage.removeItem(this.options.session_reset_key)}checkSessionToken(t){const e=null!==this.sessionStorage.getItem(this.options.session_reset_key),s=t||e,n=this.session.getSessionToken();return s||!n}async coldStart(t={},e){this.singleBuffer=!1;const s=this.checkSessionToken(t.forceNew);e&&await this.setupConditionalStart(t);const n=()=>{this.orderNumber+=1,ut(),this.coldStartTs=dt(),this.orderNumber%2==0?(this.bufferedMessages1.length=0,this.bufferedMessages1.push(Ot(this.timestamp())),this.bufferedMessages1.push(we(this.session.getTabId()))):(this.bufferedMessages2.length=0,this.bufferedMessages2.push(Ot(this.timestamp())),this.bufferedMessages2.push(we(this.session.getTabId()))),this.stop(!1),this.activityState=Vs.ColdStart,t.sessionHash&&this.session.applySessionHash(t.sessionHash),t.forceNew&&this.session.reset(),this.session.assign({userID:t.userID,metadata:t.metadata}),s||(this.debug.log("continuing session on new tab",this.session.getTabId()),this.send(Se(this.session.getTabId()))),this.observer.observe(),this.ticker.start()};this.coldInterval=setInterval((()=>{n()}),3e4),n()}async setupConditionalStart(t){this.conditionsManager=new st(this,t);const e=await fetch(this.options.ingestPoint+"/v1/web/start",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({...this.getTrackerInfo(),timestamp:dt(),doNotRecord:!0,bufferDiff:0,userID:this.session.getInfo().userID,token:void 0,deviceMemory:Ce,jsHeapSizeLimit:_e,timezone:Ks(),width:window.screen.width,height:window.screen.height})}),{token:s,userBrowser:n,userCity:i,userCountry:r,userDevice:o,userOS:a,userState:c,projectID:h,features:u}=await e.json();this.features=u||this.features,this.session.assign({projectID:h}),this.session.setUserInfo({userBrowser:n,userCity:i,userCountry:r,userDevice:o,userOS:a,userState:c});const l={sessionToken:s,userUUID:"",sessionID:""};this.startCallbacks.forEach((t=>t(l))),await(this.conditionsManager?.fetchConditions(h,s)),this.features["feature-flags"]&&(await this.featureFlags.reloadFlags(s),this.conditionsManager?.processFlags(this.featureFlags.flags)),await this.tagWatcher.fetchTags(this.options.ingestPoint,s)}offlineRecording(t={},e){this.onSessionSent=e,this.singleBuffer=!0;const s=this.checkSessionToken(t.forceNew);ut(),this.coldStartTs=dt();const n=this.localStorage.getItem(qs);if(n){const t=JSON.parse(n);this.bufferedMessages1=Array.isArray(t)?t:this.bufferedMessages1,this.localStorage.removeItem(qs)}this.bufferedMessages1.push(Ot(this.timestamp())),this.bufferedMessages1.push(we(this.session.getTabId())),this.activityState=Vs.ColdStart,t.sessionHash&&this.session.applySessionHash(t.sessionHash),t.forceNew&&this.session.reset(),this.session.assign({userID:t.userID,metadata:t.metadata});const i={sessionToken:"",userUUID:"",sessionID:""};return this.startCallbacks.forEach((t=>t(i))),s||this.send(Se(this.session.getTabId())),this.observer.observe(),this.ticker.start(),{saveBuffer:this.saveBuffer,getBuffer:this.getBuffer,setBuffer:this.setBuffer}}saveBuffer(){this.localStorage.setItem(qs,JSON.stringify(this.bufferedMessages1))}getBuffer(){return this.bufferedMessages1}setBuffer(t){this.bufferedMessages1=t}async uploadOfflineRecording(){this.stop(!1);const t=dt();this.worker?.postMessage({type:"start",pageNo:this.session.incPageNo(),ingestPoint:this.options.ingestPoint,timestamp:this.coldStartTs,url:document.URL,connAttemptCount:this.options.connAttemptCount,connAttemptGap:this.options.connAttemptGap,tabId:this.session.getTabId()});const e=await fetch(this.options.ingestPoint+"/v1/web/start",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({...this.getTrackerInfo(),timestamp:t,doNotRecord:!1,bufferDiff:t-this.coldStartTs,userID:this.session.getInfo().userID,token:void 0,deviceMemory:Ce,jsHeapSizeLimit:_e,timezone:Ks()})}),{token:s,userBrowser:n,userCity:i,userCountry:r,userDevice:o,userOS:a,userState:c,beaconSizeLimit:h,projectID:u}=await e.json();for(this.worker?.postMessage({type:"auth",token:s,beaconSizeLimit:h}),this.session.assign({projectID:u}),this.session.setUserInfo({userBrowser:n,userCity:i,userCountry:r,userDevice:o,userOS:a,userState:c});this.bufferedMessages1.length>0;)await this.flushBuffer(this.bufferedMessages1);this.postToWorker([["q_end"]]),this.clearBuffers()}async _start(t={},e=!1,s){0!==Object.keys(t).length&&(this.prevOpts=t);const n=this.activityState===Vs.ColdStart;if(n&&this.coldInterval&&clearInterval(this.coldInterval),!this.worker&&!this.insideIframe){const t="No worker found: perhaps, CSP is not set.";return this.signalError(t,[]),Promise.resolve(Ws(t))}if(this.activityState===Vs.Active||this.activityState===Vs.Starting){const t="OpenReplay: trying to call `start()` on the instance that has been started already.";return Promise.resolve(Ws(t))}this.activityState=Vs.Starting,n||ut(),t.sessionHash&&this.session.applySessionHash(t.sessionHash),t.forceNew&&this.session.reset(),this.session.assign({userID:t.userID,metadata:t.metadata});const i=dt();this.worker?.postMessage({type:"start",pageNo:this.session.incPageNo(),ingestPoint:this.options.ingestPoint,timestamp:n?this.coldStartTs:i,url:document.URL,connAttemptCount:this.options.connAttemptCount,connAttemptGap:this.options.connAttemptGap,tabId:this.session.getTabId()});const r=this.session.getSessionToken(),o=this.checkSessionToken(t.forceNew);this.sessionStorage.removeItem(this.options.session_reset_key),this.debug.log("OpenReplay: starting session; need new session id?",o,"session token: ",r);try{const e=await window.fetch(this.options.ingestPoint+"/v1/web/start",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({...this.getTrackerInfo(),timestamp:i,doNotRecord:!1,bufferDiff:i-this.coldStartTs,userID:this.session.getInfo().userID,token:o?void 0:r,deviceMemory:Ce,jsHeapSizeLimit:_e,timezone:Ks(),condition:s,assistOnly:t.assistOnly??this.socketMode,width:window.screen.width,height:window.screen.height})});if(200!==e.status){const t=await e.text(),s=t===Us?Us:`Server error: ${e.status}. ${t}`;return Ws(s)}if(!this.worker&&!this.insideIframe){const t="no worker found after start request (this should not happen in real world)";return this.signalError(t,[]),Ws(t)}const{token:a,userUUID:c,projectID:h,beaconSizeLimit:u,compressionThreshold:l,delay:d,sessionID:p,startTimestamp:f,userBrowser:g,userCity:m,userCountry:b,userDevice:y,userOS:v,userState:S,canvasEnabled:w,canvasQuality:k,canvasFPS:T,assistOnly:I,features:E}=await e.json();if(this.features=E||this.features,"string"!=typeof a||"string"!=typeof c||"number"!=typeof f&&void 0!==f||"string"!=typeof p||"number"!=typeof d||"number"!=typeof u&&void 0!==u){const t=`Incorrect server response: ${JSON.stringify(e)}`;return this.signalError(t,[]),Ws(t)}this.delay=d,this.session.setSessionToken(a),this.session.setUserInfo({userBrowser:g,userCity:m,userCountry:b,userDevice:y,userOS:v,userState:S}),this.session.assign({sessionID:p,timestamp:f||i,projectID:h}),I?(this.socketMode=!0,this.worker?.postMessage("stop")):this.worker?.postMessage({type:"auth",token:a,beaconSizeLimit:u}),o||a!==r||(this.debug.log("continuing session on new tab",this.session.getTabId()),this.send(Se(this.session.getTabId()))),Object.entries(this.session.getInfo().metadata).forEach((([t,e])=>this.send(Jt(t,e)))),this.localStorage.setItem(this.options.local_uuid_key,c),this.compressionThreshold=l;const x={sessionToken:a,userUUID:c,sessionID:p};if(this.startCallbacks.forEach((t=>t(x))),t.startCallback&&t.startCallback($s(x)),this.features["feature-flags"]&&this.featureFlags.reloadFlags(),await this.tagWatcher.fetchTags(this.options.ingestPoint,a),this.activityState=Vs.Active,this.options.crossdomain?.enabled&&!this.insideIframe&&this.bootChildrenFrames(),w&&!this.options.canvas.disableCanvas&&(this.canvasRecorder=this.canvasRecorder??new bs(this,{fps:T,quality:k,isDebug:this.options.canvas.__save_canvas_locally,fixedScaling:this.options.canvas.fixedCanvasScaling,useAnimationFrame:this.options.canvas.useAnimationFrame})),n){const t=this.bufferedMessages1.length>this.bufferedMessages2.length?this.bufferedMessages1:this.bufferedMessages2;for(;t.length>0;)await this.flushBuffer(t);this.clearBuffers(),this.commit()}else this.insideIframe&&this.rootId?this.observer.crossdomainObserve(this.rootId,this.frameOderNumber):this.observer.observe(),this.ticker.start();if(this.canvasRecorder?.startTracking(),this.features["usability-test"]&&!this.insideIframe){let t;this.uxtManager=this.uxtManager?this.uxtManager:new hs(this,zs);const e=this.localStorage.getItem(zs);if(e&&(t=parseInt(e,10)),location?.search){const e=new URLSearchParams(location.search);if(e.has("oruxt")){const s=e.get("oruxt");t=s?parseInt(s,10):void 0}}t&&(this.uxtManager.isActive?this.onUxtCb.forEach((e=>e(t))):this.uxtManager.getTest(t,a,Boolean(e)).then((t=>{t&&this.onUxtCb.forEach((e=>e(t)))})))}return $s(x)}catch(a){if(this.stop(),this.session.reset(),!a)return console.error("Unknown error during start"),this.signalError("Unknown error",[]),Ws("Unknown error");if(a===Us)return this.signalError(Us,[]),Ws(Us);this._debug("session_start",a);const t=a instanceof Error?a.message:a.toString();return this.signalError(t,[]),Ws(t)}}addOnUxtCb(t){this.onUxtCb.push(t)}getUxtId(){return this.uxtManager?.getTestId()}async waitStart(){return new Promise((t=>{const e=setInterval((()=>{this.canStart&&(clearInterval(e),t(!0))}),100)}))}async waitStarted(){return this.waitStatus(Vs.Active)}async waitStatus(t){return new Promise((e=>{const s=()=>{this.activityState===t?e(!0):setTimeout(s,25)};s()}))}async start(...t){if(this.activityState===Vs.Active||this.activityState===Vs.Starting){const t="OpenReplay: trying to call `start()` on the instance that has been started already.";return Promise.resolve(Ws(t))}return this.insideIframe&&this.signalIframeTracker(),document.hidden?new Promise((e=>{const s=async()=>{document.hidden||(await this.waitStart(),document.removeEventListener("visibilitychange",s),e(this._start(...t)))};document.addEventListener("visibilitychange",s)})):(await this.waitStart(),this._start(...t))}forceFlushBatch(){this.worker?.postMessage("forceFlushBatch")}getTabId(){return this.session.getTabId()}clearBuffers(){this.bufferedMessages1.length=0,this.bufferedMessages2.length=0}trackWs(t){const e=t;return(t,s,n="down")=>{"string"!=typeof t||"string"!=typeof s||s.length>5242880||t.length>255||this.send(fe("websocket",e,s,this.timestamp(),n,t))}}stop(t=!0){if(this.activityState!==Vs.NotActive)try{!this.insideIframe&&this.options.crossdomain?.enabled&&this.killChildrenFrames(),this.attributeSender.clear(),this.sanitizer.clear(),this.observer.disconnect(),this.nodes.clear(),this.ticker.stop(),this.stopCallbacks.forEach((t=>t())),this.tagWatcher.clear(),this.worker&&t&&this.worker.postMessage("stop"),this.canvasRecorder?.clear(),this.messages.length=0,this.parentActive=!1}finally{this.activityState=Vs.NotActive,this.debug.log("OpenReplay tracking stopped.")}}}const cn=at&&"InstallTrigger"in window?t=>t.message+"\n"+t.stack:t=>t.stack||t.message;function hn(t){return void 0===t?"undefined":null===t?"null":t instanceof Error?cn(t):Array.isArray(t)?`Array(${t.length})`:String(t)}function un(t){if(void 0===t)return"undefined";if(null===t)return"null";if(t instanceof Error)return cn(t);if(Array.isArray(t)){return`Array(${t.length})[${t.slice(0,10).map(hn).join(", ")}]`}if("object"==typeof t){const e=[];let s=0;for(const n in t){if(10==++s)break;const i=t[n];e.push(n+": "+hn(i))}return"{"+e.join(", ")+"}"}return t.toString()}function ln(t){return"string"==typeof t[0]&&t.unshift(t.shift().replace(/%(o|s|f|d|i)/g,((e,s)=>{const n=t.shift();if(void 0===n)return e;switch(s){case"o":return un(n);case"s":return hn(n);case"f":return function(t){return"number"!=typeof t?"NaN":t.toString()}(n);case"d":case"i":return function(t){return"number"!=typeof t?"NaN":Math.floor(t).toString()}(n);default:return e}}))),t.map(un).join(" ")}const dn=["log","info","warn","error","debug","assert"];function pn(t,e){const s=Object.assign({consoleMethods:dn,consoleThrottling:30},e);if(!Array.isArray(s.consoleMethods)||0===s.consoleMethods.length)return;const n=t.safe(((e,s)=>t.send(qt(e,ln(s)))));let i=0;const r=()=>{i=0};t.attachStartCallback(r),t.ticker.attach(r,33,!1);const o=t.safe((e=>((e,r)=>{const o={apply:function(t,e,o){Reflect.apply(t,r,o),i+=1,i>s.consoleThrottling||n(t.name,o)}};s.consoleMethods.forEach((s=>{if(-1===dn.indexOf(s))return void t.debug.error(`OpenReplay: unsupported console method "${s}"`);const n=r.console[s];e[s]=new Proxy(n,o)}))})(e.console,e)));o(window),t.observer.attachContextCallback(o)}const fn=/(^|@)\S+:\d+/,gn=/^\s*at .*(\S+:\d+|\(native\))/m,mn=/^(eval@)?(\[native code\])?$/;function bn(t,e){if(void 0!==t.stacktrace||void 0!==t["opera#sourceloc"])return function(t,e){return!t.stacktrace||t.message.includes("\n")&&t.message.split("\n").length>t.stacktrace.split("\n").length?function(t,e){const s=/Line (\d+).*script (?:in )?(\S+)/i,n=t.message.split("\n"),i=[];for(let r=2,o=n.length;r<o;r+=2){const t=s.exec(n[r]);t&&i.push({file:t[2],line:+t[1],raw:n[r]})}return vn(i)}(t):t.stack?function(t,e){const s=vn(t.stack.split("\n").filter((t=>!!t.match(fn)&&!t.match(/^Error created at/))));return s.map((t=>{const e=t.split("@"),s=yn(e.pop()),n=e.shift()||"",i=n.replace(/<anonymous function(: (\w+))?>/,"$2").replace(/\([^)]*\)/g,"")||void 0;let r;n.match(/\(([^)]*)\)/)&&(r=n.replace(/^[^(]+\(([^)]*)\)$/,"$1"));return{function:i,args:void 0===r||"[arguments not available]"===r?void 0:r.split(","),file:s[0],line:s[1]?+s[1]:void 0,col:s[2]?+s[2]:void 0,raw:t}}))}(t):function(t,e){const s=/Line (\d+).*script (?:in )?(\S+)(?:: In function (\S+))?$/i,n=t.stacktrace.split("\n"),i=[];for(let r=0,o=n.length;r<o;r+=2){const t=s.exec(n[r]);t&&i.push({function:t[3]||void 0,file:t[2],line:t[1]?+t[1]:void 0,raw:n[r]})}return vn(i)}(t)}(t);if(t.stack&&t.stack.match(gn))return function(t,e){return s=t.stack,vn(s.split("\n").filter((t=>!!t.match(gn)))).map((t=>{t.includes("(eval ")&&(t=t.replace(/eval code/g,"eval").replace(/(\(eval at [^()]*)|(,.*$)/g,""));let e=t.replace(/^\s+/,"").replace(/\(eval code/g,"(").replace(/^.*?\s+/,"");const s=e.match(/ (\(.+\)$)/);e=s?e.replace(s[0],""):e;const n=yn(s?s[1]:e);return{function:s&&e||void 0,file:["eval","<anonymous>"].includes(n[0])?void 0:n[0],line:n[1]?+n[1]:void 0,col:n[2]?+n[2]:void 0,raw:t}}));var s}(t);if(t.stack)return function(t,e){return s=t.stack,vn(s.split("\n").filter((t=>!t.match(mn)))).map((t=>{if(t.includes(" > eval")&&(t=t.replace(/ line (\d+)(?: > eval line \d+)* > eval:\d+:\d+/g,":$1")),t.includes("@")||t.includes(":")){const e=/(([^\n\r"\u2028\u2029]*".[^\n\r"\u2028\u2029]*"[^\n\r@\u2028\u2029]*(?:@[^\n\r"\u2028\u2029]*"[^\n\r@\u2028\u2029]*)*(?:[\n\r\u2028\u2029][^@]*)?)?[^@]*)@/,s=t.match(e),n=s&&s[1]?s[1]:void 0,i=yn(t.replace(e,""));return{function:n,file:i[0],line:i[1]?+i[1]:void 0,col:i[2]?+i[2]:void 0,raw:t}}return{function:t}}));var s}(t);throw new Error("Cannot parse given Error object")}function yn(t){if(!t.includes(":"))return[t,void 0,void 0];const e=/(.+?)(?::(\d+))?(?::(\d+))?$/.exec(t.replace(/[()]/g,""));return[e[1],e[2]||void 0,e[3]||void 0]}function vn(t,e){return t}function Sn(t){return[{columnNumber:t.colno,lineNumber:t.lineno,fileName:t.filename,functionName:"",source:""}]}function wn(t,e,s={}){let n=e;try{n=function(t,e){return bn(t).map((t=>({functionName:t.function,args:t.args,fileName:t.file,lineNumber:t.line,columnNumber:t.col,source:t.raw})))}(t)}catch(ii){}return de(t.name,t.message,JSON.stringify(n),JSON.stringify(s))}function kn(t,e=window,s={}){if(t instanceof ErrorEvent){if(t.error instanceof Error)return wn(t.error,Sn(t),s);{let[e,n]=t.message.split(":");return n||(e="Error",n=t.message),de(e,n,JSON.stringify(Sn(t)),JSON.stringify(s))}}if("PromiseRejectionEvent"in e&&t instanceof e.PromiseRejectionEvent){if(t.reason instanceof Error)return wn(t.reason,[],s);{let e;try{e=JSON.stringify(t.reason)}catch(Bi){e=String(t.reason)}return de("Unhandled Promise Rejection",e,"[]",JSON.stringify(s))}}return null}function Tn(t,e=document.location){return(t=t.trim()).startsWith("//")||t.startsWith("http://")||t.startsWith("https://")||t.startsWith("data:")?t:t.startsWith("/")?e.origin+t:e.origin+e.pathname+t}function In(t){function e(e,s){t.attributeSender.sendSetAttribute(e,"src","https://static.openreplay.com/tracker/placeholder.jpeg");const{width:n,height:i}=s.getBoundingClientRect();s.hasAttribute("width")||t.attributeSender.sendSetAttribute(e,"width",String(n)),s.hasAttribute("height")||t.attributeSender.sendSetAttribute(e,"height",String(i))}const s=function(e,s){const{srcset:n}=s;if(!n)return;const i=n.split(n.match(/,\s+/)?/,\s+/:",").map((t=>Tn(t))).join(", ");t.attributeSender.sendSetAttribute(e,"srcset",i)},n=function(s,n){n.src.length>1e5&&e(s,n),t.send(ee(s,"src",n.src,t.getBaseHref()))},i=t.safe((function(e){const s=Tn(e.src||"");gt(s)&&t.send(ve(t.timestamp(),0,0,0,0,0,s,"img",0,!1))})),r=t.safe((function(r){const o=t.nodes.getID(r);var a;void 0!==o&&(r.complete&&(0!==r.naturalHeight||0!==r.naturalWidth||(a=r.src,ct&&(a.startsWith("data:image/svg+xml")||a.match(/.svg$|/i)))?t.sanitizer.isHidden(o)||t.sanitizer.isObscured(o)?e(o,r):(n(o,r),s(o,r)):i(r)))})),o=Et(t.safe((e=>{for(const i of e)if("attributes"===i.type){const e=i.target,r=t.nodes.getID(e);if(void 0===r)return;"src"===i.attributeName&&n(r,e),"srcset"===i.attributeName&&s(r,e)}})),t.options.forceNgOff);t.attachStopCallback((()=>{o.disconnect()})),t.nodes.attachNodeCallback((e=>{ms(e,"img")&&(t.nodes.attachNodeListener(e,"error",(()=>i(e))),t.nodes.attachNodeListener(e,"load",(()=>r(e))),r(e),o.observe(e,{attributes:!0,attributeFilter:["src","srcset"]}))}))}const En=["text","password","email","search","number","range","date","tel","time"];const xn=at&&"labels"in HTMLInputElement.prototype?t=>{let e=t;for(;null!==(e=e.parentNode);)if(ms(e,"label"))return e;const s=t.labels;if(null!==s&&1===s.length)return s[0]}:t=>{let e=t;for(;null!==(e=e.parentNode);)if(ms(e,"label"))return e;const s=t.id;if(s){const e=t.ownerDocument.querySelectorAll('label[for="'+s+'"]');if(null!==e&&1===e.length)return e[0]}};function Cn(t){let e=vt(t);if(null===e){const s=xn(t);e=s&&s.innerText||t.placeholder||t.name||t.id||t.className||t.type}return ft(e).slice(0,100)}const _n=0,Nn=1,On=2;function Mn(t,e){const s=Object.assign({obscureInputNumbers:!0,obscureInputEmails:!0,defaultInputMode:Nn,obscureInputDates:!1},e);function n(e,n){let i=n.value,r=s.defaultInputMode;"password"===n.type||t.sanitizer.isHidden(e)?r=On:(t.sanitizer.isObscured(e)||r===_n&&(s.obscureInputNumbers&&"date"!==n.type&&/\d\d\d\d/.test(i)||s.obscureInputDates&&"date"===n.type||s.obscureInputEmails&&("email"===n.type||~i.indexOf("@"))))&&(r=Nn);let o=0;switch(r){case On:o=-1,i="";break;case Nn:o=i.length,i=""}return{value:i,mask:o}}function i(e,s){const{value:i,mask:r}=n(e,s);t.send(Pt(e,i,r))}const r=new Map,o=new Map;function a(t,e){r.get(t)!==e.value&&(r.set(t,e.value),i(t,e))}function c(e,s){o.get(e)!==s&&(o.set(e,s),t.send(Ut(e,s)))}t.attachStopCallback((()=>{r.clear(),o.clear()})),t.ticker.attach((()=>{r.forEach(((e,s)=>{const n=t.nodes.getNode(s);if(!n)return r.delete(s);a(s,n)})),o.forEach(((e,s)=>{const n=t.nodes.getNode(s);if(!n)return o.delete(s);c(s,n.checked)}))}),3),t.nodes.attachNodeCallback(t.safe((e=>{const s=t.nodes.getID(e);if(void 0!==s){if(ms(e,"select")&&(i(s,e),t.nodes.attachNodeListener(e,"change",(()=>i(s,e)))),function(t){return!!ms(t,"textarea")||!!ms(t,"input")&&En.includes(t.type)}(e)){a(s,e);let i=0,r=0,o=0;const c=()=>{i=dt()},h=()=>{0===r&&0!==i&&(r=dt()-i)},u=()=>{0!==i&&(o=dt()-i),function(e,s,i,r){const{value:o,mask:a}=n(e,s),c=Cn(s);t.send(ge(e,o,0!==a,c,i,r))}(s,e,r,o),r=0,o=0,i=0};return t.nodes.attachNodeListener(e,"focus",c),t.nodes.attachNodeListener(e,"input",h),void t.nodes.attachNodeListener(e,"change",u)}return function(t){if(!ms(t,"input"))return!1;const e=t.type;return"checkbox"===e||"radio"===e}(e)?(c(s,e.checked),void t.nodes.attachNodeListener(e,"change",(()=>c(s,e.checked)))):void 0}})))}let Rn,Dn,An;function Ln(t,e){if(An=new Date,t.nodeType!==Node.ELEMENT_NODE)throw new Error("Can't generate CSS selector for non-element node type.");if("html"===t.tagName.toLowerCase())return"html";const s={root:document.body,idName:t=>!0,className:t=>!0,tagName:t=>!0,attr:(t,e)=>!1,seedMinLength:1,optimizedMinLength:2,threshold:1e3,maxNumberOfTries:1e4,timeoutMs:void 0};Rn={...s,...e},Dn=function(t,e){if(t.nodeType===Node.DOCUMENT_NODE)return t;if(t===e.root)return t.ownerDocument;return t}(Rn.root,s);let n=Fn(t,"all",(()=>Fn(t,"two",(()=>Fn(t,"one",(()=>Fn(t,"none")))))));if(n){const e=Qn(Yn(n,t));return e.length>0&&(n=e[0]),Hn(n)}throw new Error("Selector was not found.")}function Fn(t,e,s){let n=null,i=[],r=t,o=0;for(;r;){const t=(new Date).getTime()-An.getTime();if(void 0!==Rn.timeoutMs&&t>Rn.timeoutMs)throw new Error(`Timeout: Can't find a unique selector after ${t}ms`);let a=Kn(Un(r))||Kn(...zn(r))||Kn(...qn(r))||Kn(Wn(r))||[{name:"*",penalty:3}];const c=$n(r);if("all"==e)c&&(a=a.concat(a.filter(Xn).map((t=>Vn(t,c)))));else if("two"==e)a=a.slice(0,1),c&&(a=a.concat(a.filter(Xn).map((t=>Vn(t,c)))));else if("one"==e){const[t]=a=a.slice(0,1);c&&Xn(t)&&(a=[Vn(t,c)])}else"none"==e&&(a=[{name:"*",penalty:3}],c&&(a=[Vn(a[0],c)]));for(let e of a)e.level=o;if(i.push(a),i.length>=Rn.seedMinLength&&(n=jn(i,s),n))break;r=r.parentElement,o++}return n||(n=jn(i,s)),!n&&s?s():n}function jn(t,e){const s=Qn(Gn(t));if(s.length>Rn.threshold)return e?e():null;for(let n of s)if(Pn(n))return n;return null}function Hn(t){let e=t[0],s=e.name;for(let n=1;n<t.length;n++){const i=t[n].level||0;s=e.level===i-1?`${t[n].name} > ${s}`:`${t[n].name} ${s}`,e=t[n]}return s}function Bn(t){return t.map((t=>t.penalty)).reduce(((t,e)=>t+e),0)}function Pn(t){const e=Hn(t);switch(Dn.querySelectorAll(e).length){case 0:throw new Error(`Can't select any node with this selector: ${e}`);case 1:return!0;default:return!1}}function Un(t){const e=t.getAttribute("id");return e&&Rn.idName(e)?{name:"#"+CSS.escape(e),penalty:0}:null}function zn(t){const e=Array.from(t.attributes).filter((t=>Rn.attr(t.name,t.value)));return e.map((t=>({name:`[${CSS.escape(t.name)}="${CSS.escape(t.value)}"]`,penalty:.5})))}function qn(t){return Array.from(t.classList).filter(Rn.className).map((t=>({name:"."+CSS.escape(t),penalty:1})))}function Wn(t){const e=t.tagName.toLowerCase();return Rn.tagName(e)?{name:e,penalty:2}:null}function $n(t){const e=t.parentNode;if(!e)return null;let s=e.firstChild;if(!s)return null;let n=0;for(;s&&(s.nodeType===Node.ELEMENT_NODE&&n++,s!==t);)s=s.nextSibling;return n}function Vn(t,e){return{name:t.name+`:nth-child(${e})`,penalty:t.penalty+1}}function Xn(t){return"html"!==t.name&&!t.name.startsWith("#")}function Kn(...t){const e=t.filter(Jn);return e.length>0?e:null}function Jn(t){return null!=t}function*Gn(t,e=[]){if(t.length>0)for(let s of t[0])yield*Gn(t.slice(1,t.length),e.concat(s));else yield e}function Qn(t){return[...t].sort(((t,e)=>Bn(t)-Bn(e)))}function*Yn(t,e,s={counter:0,visited:new Map}){if(t.length>2&&t.length>Rn.optimizedMinLength)for(let n=1;n<t.length-1;n++){if(s.counter>Rn.maxNumberOfTries)return;s.counter+=1;const i=[...t];i.splice(n,1);const r=Hn(i);if(s.visited.has(r))return;Pn(i)&&Zn(i,e)&&(yield i,s.visited.set(r,!0),yield*Yn(i,e,s))}}function Zn(t,e){return Dn.querySelector(Hn(t))===e}function ti(t){const e=t.tagName.toUpperCase();return"BUTTON"===e||"A"===e||"LI"===e||"SELECT"===e||"TR"===e||"TH"===e||null!=t.onclick||"button"===t.getAttribute("role")}function ei(t,e){return t instanceof Element?function(t,e){let s=t;for(;null!==s&&s!==e.documentElement;){if(St(s,"masked"))return null;s=s.parentElement}if(ls(t)){let e=t.ownerSVGElement;for(;null!==e;)t=e,e=e.ownerSVGElement}s=t;for(;null!==s&&s!==e.documentElement;){const t=s.tagName.toUpperCase();if("LABEL"===t)return null;if("INPUT"===t)return s;if(ti(s)||null!==vt(s))return s;s=s.parentElement}return t===e.documentElement?null:t}(t,e):null}function si(t,e){const{disableClickmaps:s=!1}=e||{};let n,i=-1,r=-1,o=!1,a=null,c=0,h={},u=0,l=0,d=0,p=0;t.attachStartCallback((()=>{n=setInterval((()=>function(){const e=p/225;if(!u)return void(u=e);d>4&&(e-u)/225>.008&&t.send(be(dt())),p=0,d=0,u=e}()),225)})),t.attachStopCallback((()=>{i=-1,r=-1,o=!1,a=null,h={},n&&clearInterval(n)}));const f=()=>{o&&(t.send(zt(i,r)),o=!1)},g=(n,u=!1)=>{function g(t,e,s){return h[t]=h[t]||function(t,e,s){return Ln(t,{root:e.body,seedMinLength:3,optimizedMinLength:s?.minSelectorDepth||2,threshold:s?.nthThreshold||1e3,maxNumberOfTries:s?.maxOptimiseTries||1e4})}(e,n,s)}const m=u?t.attachEventListener.bind(t):t.nodes.attachNodeListener.bind(t.nodes);m(n.documentElement,"mouseover",(t=>{const e=ei(t.target,n);e!==a&&(a=e,c=performance.now())})),m(n,"mousemove",(e=>{const[s,a]=t.observer.getDocumentOffset(n);i=e.clientX+s,r=e.clientY+a,o=!0;const c=Math.sign(e.movementX);p+=Math.abs(e.movementX)+Math.abs(e.movementY),c!==l&&(l=c,d++)}),!1),m(n,"click",(i=>{const r=ei(i.target,n);if(!i.clientX&&!i.clientY||null===r)return;const o=t.nodes.getID(r);if(void 0!==o){const h=i.pageX,u=i.pageY,l=n.documentElement.scrollWidth,d=n.documentElement.scrollHeight,p=ni(h/l),m=ni(u/d);f(),t.send(re(o,a===r?Math.round(performance.now()-c):0,function(e){const s=vt(e);if(null!==s)return s;if(ms(e,"input"))return Cn(e);if(ti(e)){let s="";return e instanceof HTMLElement&&(s=t.sanitizer.getInnerTextSecure(e)),s=s||e.id||e.className,ft(s).slice(0,100)}return""}(r),ti(r)&&!s?g(o,r,e):"",p,m),!0)}a=null}))};t.nodes.attachNodeCallback((t=>{fs(t)&&g(t)})),g(document,!0),t.ticker.attach(f,e?.trackingOffset||7)}function ni(t){return Math.round(1e4*t)}var ii,ri=-1,oi=function(t){addEventListener("pageshow",(function(e){e.persisted&&(ri=e.timeStamp,t(e))}),!0)},ai=function(){var t=self.performance&&performance.getEntriesByType&&performance.getEntriesByType("navigation")[0];if(t&&t.responseStart>0&&t.responseStart<performance.now())return t},ci=function(){var t=ai();return t&&t.activationStart||0},hi=function(t,e){var s=ai(),n="navigate";return ri>=0?n="back-forward-cache":s&&(document.prerendering||ci()>0?n="prerender":document.wasDiscarded?n="restore":s.type&&(n=s.type.replace(/_/g,"-"))),{name:t,value:void 0===e?-1:e,rating:"good",delta:0,entries:[],id:"v4-".concat(Date.now(),"-").concat(Math.floor(8999999999999*Math.random())+1e12),navigationType:n}},ui=function(t,e,s){try{if(PerformanceObserver.supportedEntryTypes.includes(t)){var n=new PerformanceObserver((function(t){Promise.resolve().then((function(){e(t.getEntries())}))}));return n.observe(Object.assign({type:t,buffered:!0},s||{})),n}}catch(t){}},li=function(t,e,s,n){var i,r;return function(o){e.value>=0&&(o||n)&&((r=e.value-(i||0))||void 0===i)&&(i=e.value,e.delta=r,e.rating=function(t,e){return t>e[1]?"poor":t>e[0]?"needs-improvement":"good"}(e.value,s),t(e))}},di=function(t){requestAnimationFrame((function(){return requestAnimationFrame((function(){return t()}))}))},pi=function(t){document.addEventListener("visibilitychange",(function(){"hidden"===document.visibilityState&&t()}))},fi=function(t){var e=!1;return function(){e||(t(),e=!0)}},gi=-1,mi=function(){return"hidden"!==document.visibilityState||document.prerendering?1/0:0},bi=function(t){"hidden"===document.visibilityState&&gi>-1&&(gi="visibilitychange"===t.type?t.timeStamp:0,vi())},yi=function(){addEventListener("visibilitychange",bi,!0),addEventListener("prerenderingchange",bi,!0)},vi=function(){removeEventListener("visibilitychange",bi,!0),removeEventListener("prerenderingchange",bi,!0)},Si=function(){return gi<0&&(gi=mi(),yi(),oi((function(){setTimeout((function(){gi=mi(),yi()}),0)}))),{get firstHiddenTime(){return gi}}},wi=function(t){document.prerendering?addEventListener("prerenderingchange",(function(){return t()}),!0):t()},ki=[1800,3e3],Ti=[.1,.25],Ii=function(t,e){e=e||{},function(t,e){e=e||{},wi((function(){var s,n=Si(),i=hi("FCP"),r=ui("paint",(function(t){t.forEach((function(t){"first-contentful-paint"===t.name&&(r.disconnect(),t.startTime<n.firstHiddenTime&&(i.value=Math.max(t.startTime-ci(),0),i.entries.push(t),s(!0)))}))}));r&&(s=li(t,i,ki,e.reportAllChanges),oi((function(n){i=hi("FCP"),s=li(t,i,ki,e.reportAllChanges),di((function(){i.value=performance.now()-n.timeStamp,s(!0)}))})))}))}(fi((function(){var s,n=hi("CLS",0),i=0,r=[],o=function(t){t.forEach((function(t){if(!t.hadRecentInput){var e=r[0],s=r[r.length-1];i&&t.startTime-s.startTime<1e3&&t.startTime-e.startTime<5e3?(i+=t.value,r.push(t)):(i=t.value,r=[t])}})),i>n.value&&(n.value=i,n.entries=r,s())},a=ui("layout-shift",o);a&&(s=li(t,n,Ti,e.reportAllChanges),pi((function(){o(a.takeRecords()),s(!0)})),oi((function(){i=0,n=hi("CLS",0),s=li(t,n,Ti,e.reportAllChanges),di((function(){return s()}))})),setTimeout(s,0))})))},Ei=0,xi=1/0,Ci=0,_i=function(t){t.forEach((function(t){t.interactionId&&(xi=Math.min(xi,t.interactionId),Ci=Math.max(Ci,t.interactionId),Ei=Ci?(Ci-xi)/7+1:0)}))},Ni=function(){return ii?Ei:performance.interactionCount||0},Oi=function(){"interactionCount"in performance||ii||(ii=ui("event",_i,{type:"event",buffered:!0,durationThreshold:0}))},Mi=[],Ri=new Map,Di=0,Ai=[],Li=function(t){if(Ai.forEach((function(e){return e(t)})),t.interactionId||"first-input"===t.entryType){var e=Mi[Mi.length-1],s=Ri.get(t.interactionId);if(s||Mi.length<10||t.duration>e.latency){if(s)t.duration>s.latency?(s.entries=[t],s.latency=t.duration):t.duration===s.latency&&t.startTime===s.entries[0].startTime&&s.entries.push(t);else{var n={id:t.interactionId,latency:t.duration,entries:[t]};Ri.set(n.id,n),Mi.push(n)}Mi.sort((function(t,e){return e.latency-t.latency})),Mi.length>10&&Mi.splice(10).forEach((function(t){return Ri.delete(t.id)}))}}},Fi=function(t){var e=self.requestIdleCallback||self.setTimeout,s=-1;return t=fi(t),"hidden"===document.visibilityState?t():(s=e(t),pi(t)),s},ji=[200,500],Hi=function(t,e){"PerformanceEventTiming"in self&&"interactionId"in PerformanceEventTiming.prototype&&(e=e||{},wi((function(){var s;Oi();var n,i=hi("INP"),r=function(t){Fi((function(){t.forEach(Li);var e=function(){var t=Math.min(Mi.length-1,Math.floor((Ni()-Di)/50));return Mi[t]}();e&&e.latency!==i.value&&(i.value=e.latency,i.entries=e.entries,n())}))},o=ui("event",r,{durationThreshold:null!==(s=e.durationThreshold)&&void 0!==s?s:40});n=li(t,i,ji,e.reportAllChanges),o&&(o.observe({type:"first-input",buffered:!0}),pi((function(){r(o.takeRecords()),n(!0)})),oi((function(){Di=Ni(),Mi.length=0,Ri.clear(),i=hi("INP"),n=li(t,i,ji,e.reportAllChanges)})))})))},Bi=[2500,4e3],Pi={},Ui=[800,1800],zi=function t(e){document.prerendering?wi((function(){return t(e)})):"complete"!==document.readyState?addEventListener("load",(function(){return t(e)}),!0):setTimeout(e,0)},qi=function(t,e){e=e||{};var s=hi("TTFB"),n=li(t,s,Ui,e.reportAllChanges);zi((function(){var i=ai();i&&(s.value=Math.max(i.responseStart-ci(),0),s.entries=[i],n(!0),oi((function(){s=hi("TTFB",0),(n=li(t,s,Ui,e.reportAllChanges))(!0)})))}))};function Wi(t,e){const s=Object.assign({captureResourceTimings:!0,capturePageLoadTimings:!0,capturePageRenderTimings:!0,excludedResourceUrls:[]},e);if("PerformanceObserver"in window||(s.captureResourceTimings=!1),!s.captureResourceTimings)return;let n={};function i(e){if(e.duration<0||!gt(e.name)||t.isServiceURL(e.name))return;null!==n&&(n[e.name]=e.startTime+e.duration);let i=!1;s.excludedResourceUrls?.forEach((t=>{e.name.startsWith(t)&&(i=!0)})),i||t.send(ve(e.startTime+lt(),e.duration,e.responseStart&&e.startTime?e.responseStart-e.startTime:0,e.transferSize>e.encodedBodySize?e.transferSize-e.encodedBodySize:0,e.encodedBodySize||0,e.decodedBodySize||0,e.name,e.initiatorType,e.transferSize,e.responseStatus&&304===e.responseStatus||0===e.transferSize))}const r=new PerformanceObserver((t=>t.getEntries().forEach(i)));function o(e){if(t.active())return t.send(Ee(e.name,String(e.value)))}let a;t.attachStartCallback((function({sessionID:t}){t!==a&&(performance.getEntriesByType("resource").forEach(i),a=t),r.observe({entryTypes:["resource"]}),Ii(o),Hi(o),function(t,e){e=e||{},wi((function(){var s,n=Si(),i=hi("LCP"),r=function(t){e.reportAllChanges||(t=t.slice(-1)),t.forEach((function(t){t.startTime<n.firstHiddenTime&&(i.value=Math.max(t.startTime-ci(),0),i.entries=[t],s())}))},o=ui("largest-contentful-paint",r);if(o){s=li(t,i,Bi,e.reportAllChanges);var a=fi((function(){Pi[i.id]||(r(o.takeRecords()),o.disconnect(),Pi[i.id]=!0,s(!0))}));["keydown","click"].forEach((function(t){addEventListener(t,(function(){return Fi(a)}),{once:!0,capture:!0})})),pi(a),oi((function(n){i=hi("LCP"),s=li(t,i,Bi,e.reportAllChanges),di((function(){i.value=performance.now()-n.timeStamp,Pi[i.id]=!0,s(!0)}))}))}}))}(o),qi(o)})),t.attachStopCallback((function(){r.disconnect()}));let c=0,h=0;if(s.capturePageLoadTimings){let e=!1;t.ticker.attach((()=>{if(!e&&(0!==c&&0!==h||performance.getEntriesByType("paint").forEach((t=>{const{name:e,startTime:s}=t;switch(e){case"first-paint":c=s;break;case"first-contentful-paint":h=s}})),performance.timing.loadEventEnd||performance.now()>3e4)){e=!0;const{navigationStart:s,requestStart:n,responseStart:i,responseEnd:r,domContentLoadedEventStart:o,domContentLoadedEventEnd:a,loadEventStart:u,loadEventEnd:l}=performance.timing;t.send(Wt(n-s||0,i-s||0,r-s||0,o-s||0,a-s||0,u-s||0,l-s||0,c,h))}}),30)}if(s.capturePageRenderTimings){let e=0,s=0,i=0,r=null,o=!1;t.ticker.attach((()=>{if(o)return;const a=performance.now();if(null!==n&&(e=Math.max.apply(null,Object.keys(n).map((t=>n[t]))),a-e>1e3&&(r=function(t){const e=[],s=document.getElementsByTagName("*"),n=/url\(("[^"]*"|'[^']*'|[^)]*)\)/i;for(let i=0;i<s.length;i++){const r=s[i];let o="";if(ms(r,"img")&&(o=r.currentSrc||r.src),!o){const t=getComputedStyle(r).getPropertyValue("background-image");if(t){const e=n.exec(t);null!==e&&(o=e[1],(o.startsWith('"')||o.startsWith("'"))&&(o=o.substr(1,o.length-2)))}}if(!o)continue;const a="data:image"===o.substr(0,10)?0:t[o];if(void 0===a)continue;const c=r.getBoundingClientRect(),h=Math.max(c.top,0),u=Math.max(c.left,0),l=Math.min(c.bottom,window.innerHeight||document.documentElement&&document.documentElement.clientHeight||0),d=Math.min(c.right,window.innerWidth||document.documentElement&&document.documentElement.clientWidth||0);if(l<=h||d<=u)continue;const p=(l-h)*(d-u);e.push({time:a,area:p})}return e}(n),n=null)),null!==i&&(a-i>50&&(s=a),i=a-s>5e3?null:a),null!==r&&null===i||a>3e4){o=!0,n=null;const a=null===r?0:function(t,e){let s=Math.max(document.documentElement&&document.documentElement.clientWidth||0,window.innerWidth||0)*Math.max(document.documentElement&&document.documentElement.clientHeight||0,window.innerHeight||0)/10,n=s*t;for(let i=0;i<e.length;i++){const{time:r,area:o}=e[i];s+=o,n+=o*(r>t?r:t)}return 0===s?0:n/s}(h||c,r),{domContentLoadedEventEnd:u,navigationStart:l}=performance.timing,d=null===i?Math.max(s,h,u-l||0):0;t.send($t(a,h>e?h:e,d))}}))}}function $i(t){const e=t.defaultView;return[e&&e.scrollX||t.documentElement&&t.documentElement.scrollLeft||t.body&&t.body.scrollLeft||0,e&&e.scrollY||t.documentElement&&t.documentElement.scrollTop||t.body&&t.body.scrollTop||0]}function Vi(t){return gs(t)&&!!t.adoptedStyleSheets}let Xi=15;function Ki(){return Xi++}const Ji=new Map;function Gi(t,e,s,n,i){function r(e){t.debug.log("Openreplay: capturing axios response data",e);const{headers:r,data:o,method:a,url:c,baseURL:h}=e.config,{data:u,headers:l,status:d,response:p}=e,{data:f,headers:g,status:m}=p||{},b=s.ignoreHeaders,y=Array.isArray(b)?t=>b.includes(t):()=>b;function v(t,e){y(e[0])||(t[e[0]]=e[1])}let S={},w={};r.toJSON?S=r.toJSON():r instanceof Headers?r.forEach(((t,e)=>v(S,[e,t]))):Array.isArray(r)?r.forEach((t=>v(S,t))):"object"==typeof r&&Object.entries(r).forEach((t=>v(S,t)));const k=g||l;k.toJSON?w=k.toJSON():k instanceof Headers?k.forEach(((t,e)=>v(w,[e,t]))):Array.isArray(k)?k.forEach((t=>v(w,t))):"object"==typeof k&&Object.entries(k).forEach((([t,e])=>{y(t)||(w[t]=e)}));const T=n({url:c,method:a||"",status:d||m||0,request:{headers:S,body:o},response:{headers:w,body:f||u}});if(!T)return void t.debug.log("Openreplay: empty request/response info, skipping");const I=e.config.__openreplay_timing,E=performance.now()-I;t.debug.log("Openreplay: final req object",T),t.send(pe("xhr",String(a),String(T.url),i(T.request),i(T.response),T.status,I+lt(),E,0))}t.debug.log("Openreplay: attaching axios spy to instance",e);const o=e.interceptors.request.use((function(e){if(t.debug.log("Openreplay: capturing API request",e),e.__openreplay_timing=performance.now(),s.sessionTokenHeader){const n="string"==typeof s.sessionTokenHeader?s.sessionTokenHeader:"X-OpenReplay-Session-Token",i=t.getSessionToken();i&&e.headers.set(n,i)}return e}),(function(e){t.debug.log("Openreplay: failed API request, skipping",e)}),{synchronous:!0}),a=e.interceptors.response.use((function(t){return s.failuresOnly||r(t),t}),(function(e){var s,n;return t.debug.log("Openreplay: capturing API request error",e),null!==(n=s=e)&&"object"==typeof n&&!0===s.isAxiosError&&Boolean(e.response)?r(e.response):e instanceof Error&&t.send(wn(e,[])),Promise.reject(e)}),{synchronous:!0});t.attachStopCallback((()=>{e.interceptors.request.eject?.(o),e.interceptors.response.eject?.(a)}))}class Qi{constructor(t=[],e,s){this.ignoredHeaders=t,this.setSessionTokenHeader=e,this.sanitize=s,this.id="",this.name="",this.method="",this.url="",this.status=0,this.statusText="",this.cancelState=0,this.readyState=0,this.header={},this.responseType="",this.requestType="xhr",this.requestHeader={},this.responseSize=0,this.responseSizeText="",this.startTime=0,this.endTime=0,this.duration=0,this.getData={},this.requestData=null}getMessage(){const{reqHs:t,resHs:e}=this.writeHeaders(),s={headers:t,body:"GET"===this.method?JSON.stringify(this.getData):this.requestData},n={headers:e,body:this.response},i=this.sanitize({url:this.url,method:this.method,status:this.status,request:s,response:n});if(!i)return null;if(i.url.includes("/graphql")&&i.response.body&&"string"==typeof i.response.body){const t=i.response.body.includes("errors");i.status=t?400:200,this.requestType="graphql"}return{requestType:this.requestType,method:i.method,url:i.url,request:JSON.stringify(i.request),response:JSON.stringify(i.response),status:i.status,startTime:this.startTime,duration:this.duration,responseSize:this.responseSize}}writeHeaders(){const t={};Object.entries(this.requestHeader).forEach((([e,s])=>{this.isHeaderIgnored(e)||(t[e]=s)})),this.setSessionTokenHeader(((e,s)=>{t[e]=s}));const e={};return Object.entries(this.header).forEach((([t,s])=>{this.isHeaderIgnored(t)||(e[t]=s)})),{reqHs:t,resHs:e}}isHeaderIgnored(t){return Array.isArray(this.ignoredHeaders)?this.ignoredHeaders.map((t=>t.toLowerCase())).includes(t.toLowerCase()):this.ignoredHeaders}}const Yi=(t,e)=>{let s="";switch(t){case"":case"text":case"json":"string"==typeof e?s=e:tr(e)||Array.isArray(e)?s=JSON.stringify(e):void 0!==e&&(s=Object.prototype.toString.call(e));break;default:void 0!==e&&(s=Object.prototype.toString.call(e))}return s},Zi=t=>{if(!t)return null;let e;if("string"==typeof t){"{"!==t[0]&&"["!==t[0]||(e=t);const s=t.split("&");e=1===s.length?t:s.join(",")}else if(function(t){if(null==t)return!1;if(ArrayBuffer.isView(t))return!1;return"undefined"!=typeof Symbol&&"function"==typeof t[Symbol.iterator]}(t)){const s=[];for(const[e,n]of t)s.push(`${e}=${"string"==typeof n?n:"[object Object]"}`);e=s.join(",")}else e=t instanceof Blob||t instanceof ReadableStream||t instanceof ArrayBuffer?"byte data":tr(t)?t:"can't parse body "+typeof t;return e};function tr(t){return null!==t&&"object"==typeof t}function er(t){return t<=0?"":t>=1e6?(t/1e3/1e3).toFixed(1)+" MB":t>=1e3?(t/1e3).toFixed(1)+" KB":`${t}B`}const sr=t=>{if(t.startsWith("//")){t=`${new URL(window.location.href).protocol}${t}`}return t.startsWith("http")?new URL(t):new URL(t,window.location.href)},nr=t=>t instanceof Blob?t.type:t instanceof FormData?"multipart/form-data":t instanceof URLSearchParams?"application/x-www-form-urlencoded;charset=UTF-8":"text/plain;charset=UTF-8";class ir{constructor(t,e,s,n,i){this.ignoredHeaders=t,this.setSessionTokenHeader=e,this.sanitize=s,this.sendMessage=n,this.isServiceUrl=i}apply(t,e,s){const n=s[0],i=s[1],r=new Qi(this.ignoredHeaders,this.setSessionTokenHeader,this.sanitize);if(this.isServiceUrl(n))return t.apply(e,s);const o=sr(n);if(r.method="POST",r.url=n,r.name=(o.pathname.split("/").pop()||"")+o.search,r.requestType="beacon",r.requestHeader={"Content-Type":nr(i)},r.status=0,r.statusText="Pending",o.search&&o.searchParams){r.getData={};for(const[t,e]of o.searchParams)r.getData[t]=e}r.requestData=Zi(i),r.startTime||(r.startTime=performance.now());const a=t.apply(e,s);a?(r.endTime=performance.now(),r.duration=r.endTime-(r.startTime||r.endTime),r.status=0,r.statusText="Sent",r.readyState=4):(r.status=500,r.statusText="Unknown");const c=r.getMessage();return c&&this.sendMessage(c),a}}class rr{static create(t,e,s,n,i,r){if(t)return new Proxy(t,new ir(e,s,n,i,r))}}var or;!function(t){t[t.UNSENT=0]="UNSENT",t[t.OPENED=1]="OPENED",t[t.HEADERS_RECEIVED=2]="HEADERS_RECEIVED",t[t.LOADING=3]="LOADING",t[t.DONE=4]="DONE"}(or||(or={}));class ar{constructor(t,e){this.resp=t,this.item=e,this.mockReader()}set(t,e,s){return Reflect.set(t,e,s)}get(t,e){const s=Reflect.get(t,e);switch(e){case"arrayBuffer":case"blob":case"formData":case"json":case"text":return()=>(this.item.responseType=e.toLowerCase(),s.apply(t).then((t=>(this.item.response=Yi(this.item.responseType,t),t))))}return"function"==typeof s?s.bind(t):s}mockReader(){let t;if(!this.resp.body)return;if("function"!=typeof this.resp.body.getReader)return;const e=this.resp.body.getReader;this.resp.body.getReader=()=>{const s=e.apply(this.resp.body);if(this.item.readyState===or.DONE)return s;const n=s.read,i=s.cancel;return this.item.responseType="arraybuffer",s.read=()=>n.apply(s).then((e=>{if(t){const s=new Uint8Array(t.length+e.value.length);s.set(t),s.set(e.value,t.length),t=s}else t=new Uint8Array(e.value);return this.item.endTime=performance.now(),this.item.duration=this.item.endTime-(this.item.startTime||this.item.endTime),this.item.readyState=e.done?4:3,this.item.statusText=e.done?String(this.item.status):"Loading",this.item.responseSize=t.length,this.item.responseSizeText=er(this.item.responseSize),e.done&&(this.item.response=Yi(this.item.responseType,t)),e})),s.cancel=(...e)=>(this.item.cancelState=2,this.item.statusText="Cancel",this.item.endTime=performance.now(),this.item.duration=this.item.endTime-(this.item.startTime||this.item.endTime),this.item.response=Yi(this.item.responseType,t),i.apply(s,e)),s}}}class cr{constructor(t,e,s,n,i,r){this.ignoredHeaders=t,this.setSessionTokenHeader=e,this.sanitize=s,this.sendMessage=n,this.isServiceUrl=i,this.tokenUrlMatcher=r}apply(t,e,s){const n=s[0],i=s[1];if(!n||"string"!=typeof n&&!(null==n?void 0:n.url))return t.apply(window,s);if(n instanceof URL||"string"==typeof n?this.isServiceUrl(String(n)):this.isServiceUrl(String(n.url)))return t.apply(window,s);const r=new Qi(this.ignoredHeaders,this.setSessionTokenHeader,this.sanitize);return this.beforeFetch(r,n,i),this.setSessionTokenHeader(((t,e)=>{if(void 0===this.tokenUrlMatcher||this.tokenUrlMatcher(r.url))return void 0===s[1]&&s[0]instanceof Request?s[0].headers.append(t,e):(s[1]||(s[1]={}),void 0===s[1].headers&&(s[1]=Object.assign(Object.assign({},s[1]),{headers:{}})),void(s[1].headers instanceof Headers?s[1].headers.append(t,e):Array.isArray(s[1].headers)?s[1].headers.push([t,e]):s[1].headers[t]=e))})),t.apply(window,s).then(this.afterFetch(r)).catch((t=>{throw r.endTime=performance.now(),r.duration=r.endTime-(r.startTime||r.endTime),t}))}beforeFetch(t,e,s){let n,i="GET",r={};if("string"==typeof e?(i=(null==s?void 0:s.method)||"GET",n=sr(e),r=(null==s?void 0:s.headers)||{}):(i=e.method||"GET",n=sr(e.url),r=e.headers),t.method=i,t.requestType="fetch",t.requestHeader=r,t.url=n.toString(),t.name=(n.pathname.split("/").pop()||"")+n.search,t.status=0,t.statusText="Pending",t.readyState=1,t.startTime||(t.startTime=performance.now()),"[object Headers]"===Object.prototype.toString.call(r)){t.requestHeader={};for(const[e,s]of r)t.requestHeader[e]=s}else t.requestHeader=r;if(n.search&&n.searchParams){t.getData={};for(const[e,s]of n.searchParams)t.getData[e]=s}(null==s?void 0:s.body)&&(t.requestData=Zi(s.body))}afterFetch(t){return e=>{t.endTime=performance.now(),t.duration=t.endTime-(t.startTime||t.endTime),t.status=e.status,t.statusText=String(e.status);let s=!1;t.header={};for(const[n,i]of e.headers)t.header[n]=i,s=i.toLowerCase().indexOf("chunked")>-1||s;return s?t.readyState=3:(t.readyState=4,this.handleResponseBody(e.clone(),t).then((e=>{t.responseSize="string"==typeof e?e.length:e.byteLength,t.responseSizeText=er(t.responseSize),t.response=Yi(t.responseType,e);const s=t.getMessage();s&&this.sendMessage(s)})).catch((t=>{if("AbortError"!==t.name)throw t}))),new Proxy(e,new ar(e,t))}}handleResponseBody(t,e){const s=t.headers.get("content-type");return s&&s.includes("application/json")?(e.responseType="json",t.text()):s&&(s.includes("text/html")||s.includes("text/plain"))?(e.responseType="text",t.text()):(e.responseType="arraybuffer",t.arrayBuffer())}}class hr{static create(t,e,s,n,i,r){return new Proxy(fetch,new cr(t,e,s,n,i,r))}}class ur{constructor(t,e,s,n,i,r,o){this.ignoredHeaders=e,this.setSessionTokenHeader=s,this.sanitize=n,this.sendMessage=i,this.isServiceUrl=r,this.tokenUrlMatcher=o,this.XMLReq=t,this.XMLReq.onreadystatechange=()=>{this.onReadyStateChange()},this.XMLReq.onabort=()=>{this.onAbort()},this.XMLReq.ontimeout=()=>{this.onTimeout()},this.item=new Qi(e,s,n),this.item.requestType="xhr"}get(t,e){switch(e){case"open":return this.getOpen(t);case"send":return this.setSessionTokenHeader(((e,s)=>{(void 0===this.tokenUrlMatcher||this.tokenUrlMatcher(this.item.url))&&t.setRequestHeader(e,s)})),this.getSend(t);case"setRequestHeader":return this.getSetRequestHeader(t);default:const s=Reflect.get(t,e);return"function"==typeof s?s.bind(t):s}}set(t,e,s){switch(e){case"onreadystatechange":return this.setOnReadyStateChange(t,e,s);case"onabort":return this.setOnAbort(t,e,s);case"ontimeout":return this.setOnTimeout(t,e,s)}return Reflect.set(t,e,s)}onReadyStateChange(){if(!(this.item.url&&this.isServiceUrl(this.item.url)||(this.item.readyState=this.XMLReq.readyState,this.item.responseType=this.XMLReq.responseType,this.item.endTime=performance.now(),this.item.duration=this.item.endTime-this.item.startTime,this.updateItemByReadyState(),setTimeout((()=>{this.item.response=Yi(this.item.responseType,this.item.response)}),0),this.XMLReq.readyState!==or.DONE))){const t=this.item.getMessage();t&&this.sendMessage(t)}}onAbort(){this.item.cancelState=1,this.item.statusText="Abort";const t=this.item.getMessage();t&&this.sendMessage(t)}onTimeout(){this.item.cancelState=3,this.item.statusText="Timeout";const t=this.item.getMessage();t&&this.sendMessage(t)}getOpen(t){const e=Reflect.get(t,"open");return(...s)=>{var n,i,r;const o=s[0],a=s[1];return this.item.method=o?o.toUpperCase():"GET",this.item.url=(null===(n=a.toString)||void 0===n?void 0:n.call(a))||"",this.item.name=null!==(r=null===(i=this.item.url)||void 0===i?void 0:i.replace(new RegExp("/*$"),"").split("/").pop())&&void 0!==r?r:"",this.item.getData=((t,e={})=>{tr(e)||(e={});let s=t?t.split("?"):[];if(s.shift(),s.length>0){s=s.join("?").split("&");for(const t of s){const s=t.split("=");try{e[s[0]]=decodeURIComponent(s[1])}catch(ii){e[s[0]]=s[1]}}}return e})(this.item.url,{}),e.apply(t,s)}}getSend(t){const e=Reflect.get(t,"send");return(...s)=>{const n=s[0];return this.item.requestData=Zi(n),e.apply(t,s)}}getSetRequestHeader(t){const e=Reflect.get(t,"setRequestHeader");return(...s)=>(this.item.requestHeader||(this.item.requestHeader={}),this.item.requestHeader[s[0]]=s[1],e.apply(t,s))}setOnReadyStateChange(t,e,s){return Reflect.set(t,e,((...e)=>{this.onReadyStateChange(),null==s||s.apply(t,e)}))}setOnAbort(t,e,s){return Reflect.set(t,e,((...e)=>{this.onAbort(),s.apply(t,e)}))}setOnTimeout(t,e,s){return Reflect.set(t,e,((...e)=>{this.onTimeout(),s.apply(t,e)}))}updateItemByReadyState(){switch(this.XMLReq.readyState){case or.UNSENT:case or.OPENED:this.item.status=or.UNSENT,this.item.statusText="Pending",this.item.startTime||(this.item.startTime=performance.now());break;case or.HEADERS_RECEIVED:this.item.status=this.XMLReq.status,this.item.statusText="Loading",this.item.header={};const t=(this.XMLReq.getAllResponseHeaders()||"").split("\n");for(let e=0;e<t.length;e++){const s=t[e];if(!s)continue;const n=s.split(": "),i=n[0];this.item.header[i]=n.slice(1).join(": ")}break;case or.LOADING:this.item.status=this.XMLReq.status,this.item.statusText="Loading",this.XMLReq.response&&this.XMLReq.response.length&&(this.item.responseSize=this.XMLReq.response.length,this.item.responseSizeText=er(this.item.responseSize));break;case or.DONE:this.item.status=this.XMLReq.status||this.item.status||0,this.item.statusText=String(this.item.status),this.item.endTime=performance.now(),this.item.duration=this.item.endTime-(this.item.startTime||this.item.endTime),this.item.response=this.XMLReq.response,this.XMLReq.response&&this.XMLReq.response.length&&(this.item.responseSize=this.XMLReq.response.length,this.item.responseSizeText=er(this.item.responseSize));break;default:this.item.status=this.XMLReq.status,this.item.statusText="Unknown"}}}class lr{static create(t,e,s,n,i,r){return new Proxy(XMLHttpRequest,{construct(o){const a=new o;return new Proxy(a,new ur(a,t,e,s,n,i,r))}})}}const dr=t=>{const e=`Openreplay: Can't find ${t} in global context.`;console.warn(e)};function pr(t){return t.__or_req_data__||(t.__or_req_data__={body:void 0,headers:{}}),t.__or_req_data__}function fr(t){return"string"==typeof t?t.toUpperCase():"GET"}function gr(t,e={}){const s=Object.assign({failuresOnly:!1,ignoreHeaders:["cookie","set-cookie","authorization"],capturePayload:!1,sessionTokenHeader:!1,captureInIframes:!0,axiosInstances:void 0,useProxy:!0},e);!1===s.useProxy&&t.debug.warn("Network module is migrating to proxy api, to gradually migrate and test it set useProxy to true");const n=s.ignoreHeaders,i=Array.isArray(n)?t=>n.includes(t):()=>n,r=!0===s.sessionTokenHeader?"X-OpenReplay-SessionToken":s.sessionTokenHeader;function o(e){if(r){const s=t.getSessionToken();s&&t.safe(e)(r,s)}}function a(t){if(s.capturePayload||(delete t.request.body,delete t.response.body),s.sanitizer){const e=t.response.body;if("string"==typeof e)try{t.response.body=JSON.parse(e)}catch{}return s.sanitizer(t)}return t}function c(e){if(e&&"string"!=typeof e.body)try{e.body=JSON.stringify(e.body)}catch{e.body="<unable to stringify>",t.notify.warn("Openreplay fetch couldn't stringify body:",e.body)}return JSON.stringify(e)}const h=e=>{if(s.useProxy)return function(t,e,s,n,i,r,o={xhr:!0,fetch:!0,beacon:!0},a){var c;if(t&&(o.xhr&&(t.XMLHttpRequest?t.XMLHttpRequest=lr.create(e,s,n,i,r,a):dr("XMLHttpRequest")),o.fetch&&(t.fetch?t.fetch=hr.create(e,s,n,i,r,a):dr("fetch")),o.beacon&&(null===(c=t.navigator)||void 0===c?void 0:c.sendBeacon))){const o=t.navigator.sendBeacon;t.navigator.sendBeacon=rr.create(o,e,s,n,i,r)}}(e,s.ignoreHeaders,o,a,(e=>{s.failuresOnly&&e.status<400||t.send(pe(e.requestType,e.method,e.url,e.request,e.response,e.status,e.startTime+lt(),e.duration,e.responseSize))}),(e=>t.isServiceURL(e)),{xhr:!0,fetch:!0,beacon:!0},s.tokenUrlMatcher);const r=e.fetch.bind(e);e.fetch=(e,h={})=>{if(!("string"==typeof e||e instanceof URL)||t.isServiceURL(String(e)))return r(e,h);o((function(t,e){void 0===h.headers&&(h.headers={}),h.headers instanceof Headers?h.headers.append(t,e):Array.isArray(h.headers)?h.headers.push([t,e]):h.headers[t]=e}));const u=performance.now();return r(e,h).then((r=>{const o=performance.now()-u;if(s.failuresOnly&&r.status<400)return r;const l=r.clone();return l.text().then((s=>{const r={},d={};if(!0!==n){const t=([t,e])=>{i(t)||(r[t]=e)};h.headers instanceof Headers?h.headers.forEach(((e,s)=>t([s,e]))):Array.isArray(h.headers)?h.headers.forEach(t):"object"==typeof h.headers&&Object.entries(h.headers).forEach(t),l.headers.forEach(((t,e)=>{i(e)||(d[e]=t)}))}const p=fr(h.method),f=a({url:String(e),method:p,status:l.status,request:{headers:r,body:h.body||null},response:{headers:d,body:s}});f&&t.send(pe("fetch",p,String(f.url),c(f.request),c(f.response),l.status,u+lt(),o,0))})).catch((e=>t.debug.error("Could not process Fetch response:",e))),r}))};const h=e.XMLHttpRequest.prototype.open,u=e.XMLHttpRequest.prototype.setRequestHeader,l=e.XMLHttpRequest.prototype.send;s.axiosInstances||(e.XMLHttpRequest.prototype.open=function(e,s){const n=this;o(((t,e)=>n.setRequestHeader(t,e)));let r=0;return n.addEventListener("loadstart",(t=>{r=t.timeStamp})),n.addEventListener("load",t.safe((o=>{const{headers:h,body:u}=pr(n),l=r>0?o.timeStamp-r:0,d=(n.getAllResponseHeaders()||"").trim().split(/[\r\n]+/),p={};d.forEach((function(t){const e=t.split(": "),s=e.shift();i(s)||(p[s]=e.join(": "))}));const f=fr(e),g=a({url:String(s),method:f,status:n.status,request:{headers:h,body:u||null},response:{headers:p,body:n.response}});g&&t.send(pe("xhr",f,String(g.url),c(g.request),c(g.response),n.status,r+lt(),l,0))}))),h.apply(this,arguments)},e.XMLHttpRequest.prototype.send=function(t){return pr(this).body=t,l.apply(this,arguments)},e.XMLHttpRequest.prototype.setRequestHeader=function(t,e){i(t)||(pr(this).headers[t]=e);return u.apply(this,arguments)})};h(window),s.axiosInstances&&s.axiosInstances.forEach((e=>{Gi(t,e,s,a,c)})),s.captureInIframes&&t.observer.attachContextCallback(t.safe(h))}const mr="/installation/javascript-sdk";class br{constructor(t){if(this.options=t,this.app=null,this.crossdomainMode=!1,this.checkDoNotTrack=()=>this.options.respectDoNotTrack&&("1"==navigator.doNotTrack||"1"==window.doNotTrack),this.signalStartIssue=(t,e)=>{const s=this.checkDoNotTrack(),n=new XMLHttpRequest,i=this.options.ingestPoint||Xs;n.open("POST",i+"/v1/web/not-started"),n.send(JSON.stringify({trackerVersion:"15.0.3",projectKey:this.options.projectKey,doNotTrack:s,reason:e.length?`missing api: ${e.join(",")}`:t}))},this.restartCanvasTracking=()=>{null!==this.app&&this.app.restartCanvasTracking()},this.handleError=(t,e={})=>{if(null!==this.app)if(t instanceof Error){const s=wn(t,[],e);this.app.send(s)}else if(t instanceof ErrorEvent||"PromiseRejectionEvent"in window&&t instanceof PromiseRejectionEvent){const s=kn(t,void 0,e);null!=s&&this.app.send(s)}},this.crossdomainMode=Boolean(Tt()&&t.crossdomain?.enabled),!at||!function(t){if(null==t)return console.error(`OpenReplay: invalid options argument type. Please, check documentation on ${mt}${mr}`),!1;if("string"!=typeof t.projectKey)if("number"!=typeof t.projectKey){if("number"!=typeof t.projectID)return console.error(`OpenReplay: projectKey is missing or wrong type (string is expected). Please, check ${mt}${mr} for more information.`),!1;t.projectKey=t.projectID.toString(),yt("`projectID` option","`projectKey` option",mr)}else console.warn("OpenReplay: projectKey is expected to have a string type."),t.projectKey=t.projectKey.toString();return null!=t.sessionToken&&yt("`sessionToken` option","`sessionHash` start() option","/"),!0}(t))return;if(window.__OPENREPLAY__||!this.crossdomainMode&&Tt()&&(()=>{try{return Boolean(window.top?.document)}catch{return!1}})()&&window.top.__OPENREPLAY__)return void console.error("OpenReplay: one tracker instance has been initialised already");if(!t.__DISABLE_SECURE_MODE&&"https:"!==location.protocol)return void console.error("OpenReplay: Your website must be publicly accessible and running on SSL in order for OpenReplay to properly capture and replay the user session. You can disable this check by setting `__DISABLE_SECURE_MODE` option to `true` if you are testing in localhost. Keep in mind, that asset files on a local machine are not available to the outside world. This might affect tracking if you use css files.");const e=[],s=["Map","Set","MutationObserver","performance","timing","startsWith","Blob","Worker"];if(this.checkDoNotTrack())e.push("doNotTrack");else for(const r of s)if("timing"===r){if("performance"in window&&!(r in performance)){e.push(r);break}}else if("startsWith"===r){if(!(r in String.prototype)){e.push(r);break}}else if(!(r in window)){e.push(r);break}if(e.length>0){const t=e.join(",");return console.error(`OpenReplay: browser doesn't support API required for tracking or doNotTrack is set to 1. Reason: ${t}`),void this.signalStartIssue("missing_api",e)}const n=new an(t.projectKey,t.sessionToken,t,this.signalStartIssue,this.crossdomainMode);this.app=n,this.crossdomainMode||(function(t){let e,s,n,i,r=document.referrer;const o=t.safe((()=>{const{URL:s}=document;s!==e&&(e=s,t.send(Ie(e,r,i,document.title)),i=0,r=e)})),a=t.safe((()=>{const{innerWidth:e,innerHeight:i}=window;e===s&&i===n||(s=e,n=i,t.send(Mt(s,n)))})),c=void 0===document.hidden?Function.prototype:t.safe((()=>t.send(Yt(document.hidden))));t.attachStartCallback((()=>{e=null,i=lt(),s=n=-1,o(),a(),c()})),void 0!==document.hidden&&t.attachEventListener(document,"visibilitychange",c,!1,!1),t.ticker.attach(o,1,!1),t.ticker.attach(a,5,!1)}(n),function(t){const e=navigator.connection||navigator.mozConnection||navigator.webkitConnection;if(void 0===e)return;const s=()=>t.send(Qt(Math.round(1e3*e.downlink),e.type||"unknown"));s(),e.addEventListener("change",s)}(n),function(t,e){if(!Object.assign({capturePerformance:!0},e).capturePerformance)return;let s,n;const i=()=>{void 0!==s&&-1!==s&&(s++,requestAnimationFrame(i))};t.ticker.attach((()=>{void 0!==n&&-1!==n&&n++}),0,!1);const r=()=>{void 0!==s&&void 0!==n&&(t.send(Gt(s,n,xe.memory.totalJSHeapSize||0,xe.memory.usedJSHeapSize||0)),n=s=document.hidden?-1:0)};t.attachStartCallback((()=>{n=s=-1,r(),i()})),t.attachStopCallback((()=>{n=s=void 0})),t.ticker.attach(r,40,!1),void 0!==document.hidden&&t.attachEventListener(document,"visibilitychange",r,!1,!1)}(n,t),function(t){t.attachEventListener(window,"focus",(function(){document.hidden||(t.debug.log("Openreplay: tab change to"+t.session.getTabId()),t.send(Se(t.session.getTabId())))}),!1,!1)}(n)),si(n,t.mouse),function(t,e){let s=!1;const n=new Map;function i(t){us(t)&&(ds(t)&&n.set(t,[t.scrollLeft,t.scrollTop]),fs(t)&&n.set(t,$i(t)))}const r=t.safe((()=>{e||t.send(Rt(...$i(document)))})),o=t.safe(((e,s)=>{const n=t.nodes.getID(s);void 0!==n&&t.send(Bt(n,e[0],e[1]))}));t.attachStartCallback(r),t.attachStopCallback((()=>{s=!1,n.clear()})),t.nodes.attachNodeCallback(((e,s)=>{s&&(ds(e)&&e.scrollLeft+e.scrollTop>0?n.set(e,[e.scrollLeft,e.scrollTop]):fs(e)&&n.set(e,$i(e))),gs(e)&&t.nodes.attachNodeListener(e,"scroll",(t=>{i(t.target)}))})),t.attachEventListener(document,"scroll",(t=>{const e=t.target;e!==document?i(e):s=!0})),t.ticker.attach((()=>{s&&(r(),s=!1),n.forEach(o),n.clear()}),5,!1)}(n,this.crossdomainMode),function(t){if(null===t)return;if(!window.CSSStyleSheet)return void t.send(ne("no_stylesheet_prototype_in_window",""));const e=t.safe(((e,s,n)=>{const i=Ji.get(e);i&&("string"==typeof n?t.send(ce(i,n,s,t.getBaseHref())):t.send(he(i,s)))})),s=t.safe((e=>{let s=e;for(;s.parentRule;)s=s.parentRule;const n=s.parentStyleSheet;if(!n)return void t.debug.warn("No parent StyleSheet found for",s,e);const i=Ji.get(n);if(!i)return void t.debug.warn("No sheedID found for",n,Ji);const r=s.cssText,o=n.cssRules,a=Array.from(o).indexOf(s);a>=0?(t.send(ce(i,r,a,t.getBaseHref())),t.send(he(i,a+1))):t.debug.warn("Rule index not found in",n,s)})),n=t.safe((t=>{const{insertRule:n,deleteRule:i}=t.CSSStyleSheet.prototype,{insertRule:r,deleteRule:o}=t.CSSGroupingRule.prototype;t.CSSStyleSheet.prototype.insertRule=function(t,s=0){return e(this,s,t),n.call(this,t,s)},t.CSSStyleSheet.prototype.deleteRule=function(t){return e(this,t),i.call(this,t)},t.CSSGroupingRule.prototype.insertRule=function(t,e=0){const n=r.call(this,t,e);return s(this),n},t.CSSGroupingRule.prototype.deleteRule=function(t=0){const e=o.call(this,t);return s(this),e}}));n(window),t.observer.attachContextCallback(n),t.nodes.attachNodeCallback((s=>{if(!ms(s,"style")||!s.sheet)return;if(null!==s.textContent&&s.textContent.trim().length>0)return;const n=t.nodes.getID(s);if(!n)return;const i=s.sheet,r=Ki();Ji.set(i,r),t.send(ue(r,n));const o=i.cssRules;for(let t=0;t<o.length;t++)e(i,t,o[t].cssText)}))}(n),function(t){if(null===t)return;if(!Vi(document))return;const e=new Map,s=new Map,n=n=>setTimeout((()=>{let i=t.nodes.getID(n);if(n===document&&(i=0),void 0===i)return;let r=s.get(i);r||(r=[]);const o=[],a=n.adoptedStyleSheets;if(a&&Symbol.iterator in a)for(const s of a){let n=e.get(s);const a=!n;if(n||(n=Ki(),e.set(s,n)),r.includes(n)||t.send(ue(n,i)),a){const e=s.cssRules;for(let s=0;s<e.length;s++)t.send(ce(n,e[s].cssText,s,t.getBaseHref()))}o.push(n)}if(Symbol.iterator in r)for(const e of r)o.includes(e)||t.send(le(e,i));s.set(i,o)}),20);function i(t){const e=Object.getOwnPropertyDescriptor(t,"adoptedStyleSheets");e&&Object.defineProperty(t,"adoptedStyleSheets",{...e,set:function(t){const s=e.set.call(this,t);return n(this),s}})}const r=s=>{if(s.__openreplay_adpss_patched__)return;s.__openreplay_adpss_patched__=!0,i(s.Document.prototype),i(s.ShadowRoot.prototype);const{replace:n,replaceSync:r}=s.CSSStyleSheet.prototype;s.CSSStyleSheet.prototype.replace=function(s){return n.call(this,s).then((n=>{const i=e.get(this);return i&&t.send(ae(i,s,t.getBaseHref())),n}))},s.CSSStyleSheet.prototype.replaceSync=function(s){const n=e.get(this);return n&&t.send(ae(n,s,t.getBaseHref())),r.call(this,s)}};r(window),t.observer.attachContextCallback(t.safe(r)),t.attachStopCallback((()=>{e.clear(),s.clear()})),t.attachStartCallback((()=>{n(document)})),t.nodes.attachNodeCallback((t=>{Vi(t)&&n(t)}))}(n),pn(n,t),function(t,e){function s(e){function s(s){const n=kn(s,e);null!=n&&t.send(n)}try{t.attachEventListener(e,"unhandledrejection",s),t.attachEventListener(e,"error",s)}catch(ii){console.error("Error while attaching to error proto contexts",ii)}}Object.assign({captureExceptions:!0},e).captureExceptions&&(t.observer.attachContextCallback(s),s(window))}(n,t),In(n),Mn(n,t),Wi(n,t),function(t){function e(e){const s=t.nodes.getID(e);void 0!==s&&t.send(te(s))}let s=!1;t.nodes.attachNodeCallback((n=>{ms(n,"body")&&(t.nodes.attachNodeListener(n,"focus",(t=>{us(t.target)&&(e(t.target),s=!1)})),t.nodes.attachNodeListener(n,"blur",(e=>{null===e.relatedTarget&&(s=!0,setTimeout((()=>{s&&t.send(te(-1))}),0))})))})),t.attachStartCallback((()=>{let t=document.activeElement;for(;t&&ms(t,"iframe")&&t.contentDocument;)t=t.contentDocument.activeElement;t&&t!==t.ownerDocument.body&&e(t)}),!0)}(n),function(t){if(!window.FontFace)return;const e=new Map,s=s=>{class n extends s.FontFace{constructor(...n){if("string"==typeof n[1]){let i="";n[2]&&t.safe((()=>{i=JSON.stringify(n[2])}));const r=[n[0],n[1],i],o=e.get(s.document)||[];o.push(r),e.set(s.document,o);const a=s===window?0:t.nodes.getID(s.document);if(void 0===a)return;t.active()&&t.send(Zt(a,...r))}super(...n)}}s.FontFace=n};t.observer.attachContextCallback(s),s(window),t.nodes.attachNodeCallback(t.safe((s=>{if(!fs(s))return;const n=e.get(s);if(!n)return;const i=s.defaultView===window?0:t.nodes.getID(s);void 0!==i&&n.forEach((e=>{t.send(Zt(i,...e))}))})))}(n),gr(n,t.network),function(t){t.attachEventListener(document,"selectionchange",(()=>{const e=document.getSelection();if(null===e||e.isCollapsed)t.send(me(-1,-1,""));else{const s=t.nodes.getID(e.anchorNode),n=t.nodes.getID(e.focusNode),i=e.toString().replace(/\s+/g," ");s&&n&&t.send(me(s,n,i))}}))}(n),window.__OPENREPLAY__=this,t.flags&&t.flags.onFlagsLoad&&this.onFlagsLoad(t.flags.onFlagsLoad);const i=window.open;(t.autoResetOnWindowOpen||t.resetTabOnWindowOpen)&&(n.attachStartCallback((()=>{const e=n.getTabId(),s=n.sessionStorage??window.sessionStorage;window.open=function(...r){return t.autoResetOnWindowOpen&&n.resetNextPageSession(!0),t.resetTabOnWindowOpen&&s.removeItem(t.session_tabid_key||"__openreplay_tabid"),n.resetNextPageSession(!1),s.setItem(t.session_tabid_key||"__openreplay_tabid",e),i.call(window,...r)}})),n.attachStopCallback((()=>{window.open=i})))}isFlagEnabled(t){return this.featureFlags.isFlagEnabled(t)}onFlagsLoad(t){this.app?.featureFlags.onFlagsLoad(t)}clearPersistFlags(){this.app?.featureFlags.clearPersistFlags()}reloadFlags(){return this.app?.featureFlags.reloadFlags()}getFeatureFlag(t){return this.app?.featureFlags.getFeatureFlag(t)}getAllFeatureFlags(){return this.app?.featureFlags.flags}use(t){return t(this.app,this.options)}isActive(){return null!==this.app&&this.app.active()}trackWs(t){if(null!==this.app)return this.app.trackWs(t)}start(t){return this.browserEnvCheck()?null===this.app?Promise.reject("Browser doesn't support required api, or doNotTrack is active."):this.app.start(t):Promise.reject("Trying to start not in browser.")}browserEnvCheck(){return!!at||(console.error(`OpenReplay: you are trying to start Tracker on a node.js environment. If you want to use OpenReplay with SSR, please, use componentDidMount or useEffect API for placing the \`tracker.start()\` line. Check documentation on ${mt}${mr}`),!1)}coldStart(t,e){return this.browserEnvCheck()?null===this.app?Promise.reject("Tracker not initialized"):void this.app.coldStart(t,e):Promise.reject("Trying to start not in browser.")}startOfflineRecording(t,e){return this.browserEnvCheck()?null===this.app?Promise.reject("Tracker not initialized"):this.app.offlineRecording(t,e):Promise.reject("Trying to start not in browser.")}uploadOfflineRecording(){if(null!==this.app)return this.app.uploadOfflineRecording()}stop(){if(null!==this.app)return this.app.stop(),this.app.session.getSessionHash()}forceFlushBatch(){null!==this.app&&this.app.forceFlushBatch()}getSessionToken(){return null===this.app?null:this.app.getSessionToken()}getSessionInfo(){return null===this.app?null:this.app.session.getInfo()}getSessionID(){return null===this.app?null:this.app.getSessionID()}getTabId(){return null===this.app?null:this.app.getTabId()}getUxId(){return null===this.app?null:this.app.getUxtId()}sessionID(){return yt("'sessionID' method","'getSessionID' method","/"),this.getSessionID()}getSessionURL(t){if(null!==this.app)return this.app.getSessionURL(t)}setUserID(t){"string"==typeof t&&null!==this.app&&this.app.session.setUserID(t)}userID(t){yt("'userID' method","'setUserID' method","/"),this.setUserID(t)}setUserAnonymousID(t){"string"==typeof t&&null!==this.app&&this.app.send(Kt(t))}userAnonymousID(t){yt("'userAnonymousID' method","'setUserAnonymousID' method","/"),this.setUserAnonymousID(t)}setMetadata(t,e){"string"==typeof t&&"string"==typeof e&&null!==this.app&&this.app.session.setMetadata(t,e)}metadata(t,e){yt("'metadata' method","'setMetadata' method","/"),this.setMetadata(t,e)}event(t,e=null,s=!1){if("string"==typeof t&&null!==this.app){if(s)return this.issue(t,e);try{e=JSON.stringify(e)}catch(ii){return}this.app.send(Vt(t,e))}}issue(t,e=null){if("string"==typeof t&&null!==this.app){try{e=JSON.stringify(e)}catch(ii){return}this.app.send(ie(t,e))}}}}}]);